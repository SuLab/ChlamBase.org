angular.module("cmod",["ui.bootstrap","ngResource","ngRoute","ngTable","ngCookies","filters","browserPage","mainPage","organismForm","resources","proteinView","organismView","jbrowseView","annotationsView","landingPage","geneOntology","interPro","operonAnnotations","goForm","operonForm","geneOverview","enzymeView","mutantsView","allgenesDownload","angularUtils.directives.dirPagination","oauthView","advSearchPage","keywordForm","organismTree","linkedPubs","orthologView","mutantForm","expressionView","hostPathogen","hostpathForm","alignmentView","geneNameForm","oauthForm","advancedKeywordForm","localizationView","localizationForm","footer","header","pdbForm","geneSymbolForm","advancedSearchFilter"]);angular.module("cmod").config(["$locationProvider","$routeProvider","$httpProvider","$interpolateProvider","$compileProvider",function(e,a,t,o,n){"use strict";e.html5Mode({enabled:!0}),n.aHrefSanitizationWhitelist(/^\s*(|blob|):/),n.aHrefSanitizationWhitelist(/^\s*(https?|ftp|mailto|chrome-extension):/),a.when("/",{template:"<landing-page></landing-page>"}).when("/organism/:taxid/",{template:"<browser-page></browser-page>"}).when("/keyword/:keyword",{template:"<adv-search-page></adv-search-page>"}).when("/keyword/",{template:"<adv-search-page></adv-search-page>"}).when("/organism/:taxid/gene/:locusTag",{template:"<main-page></main-page>"}).when("/organism/:taxid/gene/:locusTag/authorized/",{template:"<main-page></main-page>"}).otherwise({template:"<not-found></not-found>"}),o.startSymbol("{$"),o.endSymbol("$}"),t.defaults.headers.post["Content-Type"]="application/x-www-form-urlencoded"}]).run(["$http","$cookies",function(e,a){e.defaults.headers.post["X-CSRFToken"]=a.get("csrftoken")}]);angular.module("filters",[]);angular.module("filters").filter("parseQID",function(){return function(r){return r?r.split("/").slice(-1)[0]:"None"}}),angular.module("filters").filter("interactions2bacteria",function(){return function(r){var t=[];return angular.forEach(r,function(r){var n=r.hostLabel.value;"Homo sapiens"!=n&&"Mus musculus"!=n&&t.push(r)}),t}}),angular.module("filters").filter("interactions2host",function(){return function(r){var t=[];return angular.forEach(r,function(r){var n=r.hostLabel.value;"Homo sapiens"!=n&&"Mus musculus"!=n||t.push(r)}),t}}),angular.module("filters").filter("replaceColon",function(){return function(r){return r.split(":").join("_")}}),angular.module("filters").filter("replaceColon",function(){return function(r){return r.split(":").join("_")}}),angular.module("filters").filter("replaceperiod",function(){return function(r){return r.split(".").join("_")}}),angular.module("filters").filter("convertStrand",function(){return function(r){return r?"Q22809711"===r?"reverse":"forward":"None"}}),angular.module("filters").filter("strandNum",function(){return function(r){return r?"Q22809711"===r?"2":"1":"None"}}),angular.module("filters").filter("uniqueGoTerms",function(){return function(r){var t=[];return angular.forEach(r,function(n){angular.forEach(t,function(r){n!=r&&t.push(r)})}),t}}),angular.module("filters").filter("goClass",function(){var n={mf_button:"Molecular Function",cc_button:"Cellular Component",bp_button:"Biological Process"};return function(r){return n[r]}}),angular.module("filters").filter("startFrom",function(){return function(r,n){return n=+n,r.slice(n)}}),angular.module("filters").filter("list2CSV",function(){return function(r){return r?r.join(", "):"None"}}),angular.module("filters").filter("getJsonItem",function(){return function(t,u,r){var e;return angular.forEach(r,function(r,n){if(r[t].value!=u)return"none";e=r}),e}}),angular.module("filters").filter("getJsonItemNoWD",function(){return function(t,u,r){var e=[];return angular.forEach(r,function(r,n){if(r[t]!=u)return"none";e.push(r)}),e}}),angular.module("filters").filter("deleteJsonItem",function(){return function(t,u,r){var e=[];return angular.forEach(r,function(r,n){r[t].value!=u||e.push(r)}),e}}),angular.module("filters").filter("deleteJsonItemValuesList",function(){return function(u,r,n){var e=[];return angular.forEach(r,function(t){angular.forEach(n,function(r,n){r[u].value==t&&e.push(r)})}),e}}),angular.module("filters").filter("getJsonItemOrg",function(){return function(t,u,r){var e;return angular.forEach(r,function(r,n){if(r[t]!=u)return"none";e=r}),e}}),angular.module("filters").filter("orderObjectBy",function(){return function(r,t){if(!angular.isObject(r))return r;var n=[];for(var u in r)n.push(r[u]);return n.sort(function(r,n){return(r=parseInt(r[t].value))-(n=parseInt(n[t].value))}),n}}),angular.module("filters").filter("keywordFilter",["$filter",function(u){return function(n,r){var t=r.split(" ");return angular.forEach(t,function(r){r&&(n=u("filter")(n,r))}),n}}]),angular.module("filters").filter("locusTagFilter",["$filter",function(r){return function(r,n){var t=[];return angular.forEach(r,function(r){-1!=n.indexOf(r.locusTag.value)&&t.push(r)}),t}}]),angular.module("filters").filter("cut",function(){return function(r,n,t,u){if(!r)return"";if(!(t=parseInt(t,10)))return r;if(r.length<=t)return r;if(r=r.substr(0,t),n){var e=r.lastIndexOf(" ");-1!=e&&("."!=r.charAt(e-1)&&","!=r.charAt(e-1)||(e-=1),r=r.substr(0,e))}return r+(u||" â€¦")}}),angular.module("filters").filter("typeFilter",function(){var n={Q7187:"gene",Q20747295:"protein-coding-gene",Q8054:"protein"};return function(r){return n[r]}});angular.module("resources",[]);angular.module("resources").factory("appData",["$resource",function(e){return e("/static/wiki/json/application_data.json",{},{getAppData:{method:"GET",params:{},cache:!0}})}]),angular.module("resources").factory("taxidFilter",["$resource","$q",function(e,n){var o=e("/static/wiki/json/tax_map.json",{},{getTaxMap:{method:"GET",params:{},cache:!0}});return{name:function(r){var t=n.defer();return o.getTaxMap(function(e){t.resolve(e[r])}),t.promise},species:function(r){var t=n.defer();return o.getTaxMap(function(e){t.resolve(e[r].split(" ").slice(0,2).join(" "))}),t.promise},strain:function(r){var t=n.defer();return o.getTaxMap(function(e){t.resolve(e[r].split(" ").slice(2).join(" "))}),t.promise},map:function(){var r=n.defer();return o.getTaxMap(function(e){r.resolve(e)}),r.promise}}}]),angular.module("resources").factory("orgTree",["$resource",function(e){return e("/static/wiki/json/org_tree.json",{},{getOrgTree:{method:"GET",params:{},cache:!0}})}]),angular.module("resources").factory("allOrgs",["$resource",function(e){return e("/static/wiki/json/orgsList.json",{},{getAllOrgs:{method:"GET",params:{},isArray:!0,cache:!0}})}]),angular.module("resources").factory("evidenceCodes",["$resource",function(e){return e("/static/wiki/json/evidence_codes.json",{},{getevidenceCodes:{method:"GET",params:{},isArray:!0,cache:!0}})}]),angular.module("resources").factory("mutantData",["$resource",function(e){return e("/static/wiki/json/kokes.json",{},{getKokesMutants:{method:"GET",params:{},isArray:!0,cache:!0}})}]),angular.module("resources").factory("expressionTimingData",["$resource",function(e){return e("/static/wiki/json/expression_timing.json",{},{getExpression:{method:"GET",params:{},isArray:!0,cache:!0}})}]),angular.module("resources").factory("pdbData",["$http",function(t){return{getPdbData:function(e){var r="https://query.wikidata.org/sparql?format=json&query="+encodeURIComponent("SELECT ?pdbId ?pmid WHERE {?protein wdt:P352 '"+e+"'.?protein p:P638 ?pdbClaim.?pdbClaim ps:P638 ?pdbId.?pdbClaim prov:wasDerivedFrom/pr:P248/wdt:P698 ?pmid.}");return t.get(r).success(function(e){return e.data}).error(function(e){return e})}}}]),angular.module("resources").factory("orthoDataByLocusTag",["$http","$q",function(n,o){return{getOrthologs:function(e){var r=o.defer(),t="https://query.wikidata.org/sparql?format=json&query="+encodeURIComponent("SELECT ?orthoLocusTag ?orthoTaxid ?entrez ?uniprot ?refseq ?reference WHERE {{?gene wdt:P2393 '"+e+"'.?gene p:P684 ?statement.?statement ps:P684 ?ortholog.?ortholog wdt:P2393 ?orthoLocusTag.?ortholog wdt:P703 ?orthoTaxon.?orthoTaxon wdt:P685 ?orthoTaxid.OPTIONAL {?ortholog wdt:P351 ?entrez.}?statement prov:wasDerivedFrom/pr:P248 ?reference.OPTIONAL {?ortholog wdt:P688 ?protein.?protein wdt:P352 ?uniprot.?protein wdt:P637 ?refseq.}}UNION{?gene wdt:P2393 '"+e+"'.?gene wdt:P2393 ?orthoLocusTag.?gene wdt:P703 ?orthoTaxon.?orthoTaxon wdt:P685 ?orthoTaxid.OPTIONAL {?gene wdt:P351 ?entrez.}OPTIONAL {?gene wdt:P688 ?protein.?protein wdt:P352 ?uniprot.?protein wdt:P637 ?refseq.}}}");return n.get(t).success(function(e){r.resolve(e)}).error(function(e){r.reject(e)}),r.promise}}}]),angular.module("resources").factory("orthoDataByEntrez",["$http","$q",function(n,o){return{getOrthologs:function(e){var r=o.defer(),t="https://query.wikidata.org/sparql?format=json&query="+encodeURIComponent("SELECT ?orthoLocusTag ?orthoTaxid ?entrez ?uniprot ?refseq ?reference WHERE {{?gene wdt:P351 '"+e+"'.?gene p:P684 ?statement.?statement ps:P684 ?ortholog.OPTIONAL {?ortholog wdt:P2393 ?orthoLocusTag.}?ortholog wdt:P703 ?orthoTaxon.?orthoTaxon wdt:P685 ?orthoTaxid.OPTIONAL {?ortholog wdt:P351 ?entrez.}?statement prov:wasDerivedFrom/pr:P248 ?reference.OPTIONAL {?ortholog wdt:P688 ?protein.?protein wdt:P352 ?uniprot.?protein wdt:P637 ?refseq.}}UNION{?gene wdt:P351 '"+e+"'.OPTIONAL {?gene wdt:P2393 ?orthoLocusTag.}?gene wdt:P703 ?orthoTaxon.?orthoTaxon wdt:P685 ?orthoTaxid.OPTIONAL {?gene wdt:P351 ?entrez.}OPTIONAL {?gene wdt:P688 ?protein.?protein wdt:P352 ?uniprot.?protein wdt:P637 ?refseq.}}}");return n.get(t).success(function(e){r.resolve(e)}).error(function(e){r.reject(e)}),r.promise}}}]),angular.module("resources").factory("sendToView",["$http",function(n){return{sendToView:function(e,r){var t=e;return n.post(t,r).success(function(e){return e}).error(function(e,r){return r})}}}]),angular.module("resources").factory("uploadFile",["$http",function(n){return{uploadFile:function(e,r){var t=e;return n.post(t,r).success(function(e){return e}).error(function(e,r){return r})}}}]),angular.module("resources").factory("currentOrgFetch",["$http",function(r){return{getCurrentOrg:function(t){var e="https://query.wikidata.org/sparql?format=json&query="+encodeURIComponent("SELECT ?taxid ?taxon ?taxonLabel WHERE{ ?taxon wdt:P685 '"+t+"'. SERVICE wikibase:label { bd:serviceParam wikibase:language 'en' . } }");return r.get(e).then(function(e){var r=e.data.results.bindings;return{taxid:t,taxon:r[0].taxon.value,taxonLabel:r[0].taxonLabel.value}})}}}]),angular.module("resources").factory("speciesGenes",["$http",function(t){return{getSpeciesGenes:function(e){var r="https://query.wikidata.org/sparql?format=json&query="+encodeURIComponent("SELECT ?protein ?proteinLabel ?uniprot WHERE{ ?taxon wdt:P685 '"+e+'\'. ?protein wdt:P352 ?uniprot;wdt:P703 ?taxon;rdfs:label ?proteinLabel.FILTER (lang(?proteinLabel) = "en") }');return console.log(r),t.get(r).success(function(e){return e}).error(function(e){return e})}}}]),angular.module("resources").factory("allOrgOperons",["$http",function(t){return{getAllOrgOperons:function(e){var r="https://query.wikidata.org/sparql?format=json&query="+encodeURIComponent("SELECT ?operon ?operonLabel WHERE{ ?taxon wdt:P685 '"+e+"'. ?operon wdt:P703 ?taxon; wdt:P279 wd:Q139677. SERVICE wikibase:label { bd:serviceParam wikibase:language 'en' .}} ");return t.get(r).success(function(e){return e}).error(function(e){return e})}}}]),angular.module("resources").factory("proteinMass",["$http","$q",function(n,o){return{getMass:function(e){var r="https://www.uniprot.org/uniprot/{}.xml".replace("{}",e),t=o.defer();return n.get(r).success(function(e){return t.resolve(e.match(/mass="\d+"/)[0].match(/\d+/)[0])}).error(function(e){return t.reject(e)}),t.promise}}}]),angular.module("resources").factory("GOTerms",["$http",function(t){return{getGoTerms:function(e){var r="https://query.wikidata.org/sparql?format=json&query="+encodeURIComponent("SELECT ?gotermValueLabel ?goID ?gotermValue ?goclass ?reference_retrievedLabel (GROUP_CONCAT(DISTINCT ?reference_stated_label; SEPARATOR = '; ') AS ?reference_stated_label) (GROUP_CONCAT(DISTINCT ?determination; SEPARATOR = ';') AS ?determinationLabel) WHERE {?protein wdt:P352 '"+e+"'.?protein (p:P680|p:P681|p:P682)+ ?goterm.?goterm pq:P459/rdfs:label ?determination. FILTER(LANG(?determination) = 'en').OPTIONAL { ?goterm (prov:wasDerivedFrom/pr:P248)/rdfs:label ?reference_stated_label. FILTER(LANG(?reference_stated_label) = 'en').}OPTIONAL { ?goterm (prov:wasDerivedFrom/pr:P813) ?reference_retrieved. }?goterm (ps:P680|ps:P681|ps:P682)+ ?gotermValue.?gotermValue wdt:P31 ?goclass.?gotermValue wdt:P686 ?goID.SERVICE wikibase:label { bd:serviceParam wikibase:language 'en'. }}GROUP BY ?gotermValueLabel ?goID ?gotermValue ?goclass ?determinationLabel ?reference_retrievedLabel");return t.get(r).success(function(e){return e.data}).error(function(e){return e})}}}]),angular.module("resources").factory("ECNumbers",["$http",function(t){return{getECNumbers:function(e){var r="https://query.wikidata.org/sparql?format=json&query="+encodeURIComponent("SELECT ?ecnumber WHERE {?protein wdt:P352 '"+e+"'.?protein (wdt:P680|wdt:P681|wdt:P682)+ ?gotermValue.?gotermValue wdt:P591 ?ecnumber.}");return t.get(r).success(function(e){return e.data}).error(function(e){return e})}}}]),angular.module("resources").factory("InterPro",["$http",function(t){return{getInterPro:function(e){var r="https://query.wikidata.org/sparql?format=json&query="+encodeURIComponent("SELECT distinct ?protein ?interPro_item ?interPro_label ?ipID ?reference_stated_inLabel ?refURL WHERE {?proteinLabel wdt:P352'"+e+'\';p:P527 ?interPro.?interPro ps:P527 ?interPro_item.?interPro prov:wasDerivedFrom/pr:P248 ?reference_stated_in ;prov:wasDerivedFrom/pr:P854 ?refURL .?interPro_item wdt:P2926 ?ipID;rdfs:label ?interPro_label. SERVICE wikibase:label { bd:serviceParam wikibase:language "en" .}filter (lang(?interPro_label) = "en") .}');return t.get(r).then(function(e){return e.data.results.bindings})}}}]),angular.module("resources").factory("RefSeqChrom",["$http",function(t){var n="https://query.wikidata.org/sparql?format=json&query=";return{getRefSeqChromByLocusTag:function(e){var r=n+encodeURIComponent("SELECT ?refSeqChromosome WHERE{ \n  ?gene wdt:P2393 '"+e+"';        p:P644 ?chr.\n  ?chr pq:P1057 ?chromosome. \n  ?chromosome wdt:P2249 ?refSeqChromosome.\n  SERVICE wikibase:label { bd:serviceParam wikibase:language 'en' .}\n} \n");return t.get(r).then(function(e){return e.data.results.bindings})},getRefSeqChromByEntrez:function(e){var r=n+encodeURIComponent("SELECT ?refSeqChromosome WHERE{ \n  ?gene wdt:P351 '"+e+"';        p:P644 ?chr.\n  ?chr pq:P1057 ?chromosome. \n  ?chromosome wdt:P2249 ?refSeqChromosome.\n  SERVICE wikibase:label { bd:serviceParam wikibase:language 'en' .}\n} \n");return t.get(r).then(function(e){return e.data.results.bindings})},getAllChromosomes:function(e){var r=n+encodeURIComponent("SELECT ?chromosome ?chromosomeLabel ?refseq WHERE {   ?taxon wdt:P685 '"+e+"'.   ?chromosome wdt:P703 ?taxon;       (wdt:P279|wdt:P31) wd:Q37748;       wdt:P2249 ?refseq.   SERVICE wikibase:label { bd:serviceParam wikibase:language 'en'. }}");return t.get(r).then(function(e){return e.data.results.bindings})},getAllPlasmids:function(e){var r=n+encodeURIComponent("SELECT ?plasmid ?plasmidLabel ?refseq WHERE {   ?taxon wdt:P685 '"+e+"'.   ?plasmid wdt:P703 ?taxon;       (wdt:P279|wdt:P31) wd:Q172778;       wdt:P2249 ?refseq.   SERVICE wikibase:label { bd:serviceParam wikibase:language 'en'. }}");return t.get(r).then(function(e){return e.data.results.bindings})}}}]),angular.module("resources").factory("hostPathogen",["$http",function(t){return{getHostPathogen:function(e){var r="https://query.wikidata.org/sparql?format=json&query="+encodeURIComponent("SELECT DISTINCT ?hostGeneLabel ?hostProteinLabel ?hostLabel ?reference_stated_inLabel ?determinationLabel ?pmid WHERE {?protein wdt:P352 '"+e+"'.?protein p:P129 ?hpClaim.?hpClaim (prov:wasDerivedFrom/pr:P248) ?reference_stated_in.?hpClaim pq:P459 ?determination.?reference_stated_in wdt:P698 ?pmid.?hpClaim ps:P129 ?hostProtein.?hostProtein wdt:P703 ?host.?hostProtein wdt:P702 ?hostGene.SERVICE wikibase:label { bd:serviceParam wikibase:language 'en'. }}");return t.get(r).then(function(e){return e.data.results.bindings})}}}]),angular.module("resources").factory("tax2QID",["$http",function(t){return{getQID:function(e){var r="https://query.wikidata.org/sparql?format=json&query="+encodeURIComponent("SELECT ?taxon WHERE {?taxon wdt:P685 '"+e+"'.}");return t.get(r).then(function(e){return e.data.results.bindings})}}}]),angular.module("resources").factory("annotationSettings",["$http",function(e){return{getSettings:function(){return e.get("/static/wiki/json/module_settings.json").then(function(e){return e})}}}]),angular.module("resources").factory("OperonData",["$http",function(t){var n="https://query.wikidata.org/sparql?format=json&query=";return{getOperonDataByLocusTag:function(e){var r=n+encodeURIComponent("SELECT ?operonItemLabel ?op_genesLabel ?locusTag ?entrez ?genStart ?genEnd ?strandLabel ?reference_stated_inLabel ?reference_pmid WHERE {?gene wdt:P2393 '"+e+"';      p:P361 ?operon.?operon ps:P361 ?operonItem.OPTIONAL{?operon (prov:wasDerivedFrom/pr:P248) ?reference_stated_in.           ?reference_stated_in wdt:P698 ?reference_pmid.}?operonItem (wdt:P31|wdt:P279) wd:Q139677;           wdt:P527 ?op_genes.?op_genes wdt:P2393 ?locusTag;          wdt:P351 ?entrez;          wdt:P644 ?genStart;          wdt:P645 ?genEnd;          wdt:P2548 ?strand.SERVICE wikibase:label { bd:serviceParam wikibase:language 'en'. }}");return t.get(r).success(function(e){return e.data}).error(function(e){return e})},getOperonDataByEntrez:function(e){var r=n+encodeURIComponent("SELECT ?operonItemLabel ?op_genesLabel ?locusTag ?entrez ?genStart ?genEnd ?strandLabel ?reference_stated_inLabel ?reference_pmid WHERE {?gene wdt:P351 '"+e+"';      p:P361 ?operon.?operon ps:P361 ?operonItem.OPTIONAL{?operon (prov:wasDerivedFrom/pr:P248) ?reference_stated_in.           ?reference_stated_in wdt:P698 ?reference_pmid.}?operonItem (wdt:P31|wdt:P279) wd:Q139677;            wdt:P527 ?op_genes.?op_genes wdt:P2393 ?locusTag;          wdt:P351 ?entrez;          wdt:P644 ?genStart;          wdt:P645 ?genEnd;          wdt:P2548 ?strand.?reference_stated_in wdt:P698 ?reference_pmid.SERVICE wikibase:label { bd:serviceParam wikibase:language 'en'. }}");return t.get(r).success(function(e){return e.data}).error(function(e){return e})}}}]),angular.module("resources").factory("geneSequenceData",["$http","$q",function(c,e){"use strict";return{getSequence:function(i){var u=e.defer();return c.get("https://eutils.ncbi.nlm.nih.gov/entrez/eutils/esearch.fcgi?db=gene&term="+i).success(function(e){var s=e;if(s.includes("<Id>")){var r=s.substring(s.indexOf("<Id>")+4,s.indexOf("</Id>"));c.get("https://eutils.ncbi.nlm.nih.gov/entrez/eutils/esummary.fcgi?db=gene&id="+r).success(function(e){s=e;var r=parseInt(s.substring(s.indexOf("<ChrStart>")+10,s.indexOf("</ChrStart>")))+1,t=parseInt(s.substring(s.indexOf("<ChrStop>")+9,s.indexOf("</ChrStop>")))+1,n=s.substring(s.indexOf("<ChrAccVer>")+11,s.indexOf("</ChrAccVer>")),o=1;if(t<r){o=2;var a=r;r=t,t=a}c.get("https://eutils.ncbi.nlm.nih.gov/entrez/eutils/efetch.fcgi?db=nuccore&id="+n+"&seq_start="+r+"&seq_stop="+t+"&strand="+o+"&rettype=fasta").success(function(e){var r=">"+i+"\n",t=e.substring(e.indexOf("\n")+1,e.length).replace(/\n/g,"");u.resolve(r+t)}).error(function(e){u.reject(e)})}).error(function(e){u.reject(e)})}}),u.promise}}}]),angular.module("resources").factory("proteinSequenceData",["$http","$q",function(e,r){"use strict";return{getSequence:function(n){var o=r.defer();return n?e.get("https://eutils.ncbi.nlm.nih.gov/entrez/eutils/efetch.fcgi?db=protein&id="+n+"&rettype=fasta").then(function(e){var r=e.data,t=">"+n+"\n"+r.substring(r.indexOf("\n")+1).replace(/\n/g,"");o.resolve(t)},function(e){console.log("Error reading protein sequence"),o.reject(e)}):(console.log("No Ref Seq ID"),o.reject()),o.promise}}}]),angular.module("resources").factory("expasyData",["$http","$location",function(t,e){var n="https://"+e.host()+"/expasy/EC/{ecnumber}.txt";return{getReactionData:function(e){var r=n.replace("{ecnumber}",e);return t.get(r).then(function(e){var n={reaction:[]},r=e.data.split("\n");return angular.forEach(r,function(e,r){if(e.match("^ID")&&(n.ecnumber=e.slice(5)),e.match("^CA ")){var t=e.replace(/^(CA)/,"");n.reaction.push(t)}}),n},function(e){return e})}}}]),angular.module("resources").factory("pubMedData",["$http",function(t){return{getPMID:function(r){var e="https://eutils.ncbi.nlm.nih.gov/entrez/eutils/esummary.fcgi?db=pubmed&retmode=json&id="+r;return t.get(e).success(function(e){return e.result[r]}).error(function(e){return e})}}}]),angular.module("resources").factory("locusTag2Pub",["$http",function(t){return{getlocusTag2Pub:function(e){var r="https://www.ebi.ac.uk/europepmc/webservices/rest/search?query=chlamydia%20{locusTag}&format=json".replace("{locusTag}",e);return t.get(r).success(function(e){return e}).error(function(e){return e})}}}]),angular.module("resources").factory("euroPubData",["$http",function(t){return{getEuroPubData:function(e){var r="https://www.ebi.ac.uk/europepmc/webservices/rest/search?query={pubmedID}&resulttype=core&format=json".replace("{pubmedID}",e);return t.get(r).success(function(e){return e}).error(function(e){return e})}}}]),angular.module("resources").factory("pubLinks",["$http",function(t){return{getPubLinks:function(e){var r="https://eutils.ncbi.nlm.nih.gov/entrez/eutils/elink.fcgi?dbfrom=gene&db=pubmed&id={entrez}&retmode=json&linkname=gene_pubmed_pmc_nucleotide".replace("{entrez}",e);return t.get(r).success(function(e){return e}).error(function(e){return e})}}}]),angular.module("resources").factory("recentPubLinks",["$http",function(o){return{getRecentPubLinks:function(e,r,t){var n="https://eutils.ncbi.nlm.nih.gov/entrez/eutils/esearch.fcgi?db=pubmed&term="+e+"&reldate="+r+"&datetype=edat&retmax="+t+"&usehistory=y&retmode=json";return o.get(n).success(function(e){return e}).error(function(e){return e})}}}]),angular.module("resources").factory("allGoTerms",["$http",function(n){return{getGoTermsAll:function(e,r){var t="https://query.wikidata.org/sparql?format=json&query="+encodeURIComponent("SELECT DISTINCT ?goterm ?goID ?goterm_label WHERE { ?goterm wdt:P279* wd:"+r+"; rdfs:label ?goterm_label; wdt:P686 ?goID. FILTER(lang(?goterm_label) = 'en') FILTER(CONTAINS(LCASE(?goterm_label), '"+e.toLowerCase()+"' ))}");return n.get(t).success(function(e){return e.data}).error(function(e){return e})}}}]),angular.module("resources").factory("developmentalForm",["$http",function(t){return{getDevelopmentalForms:function(e){var r="https://query.wikidata.org/sparql?format=json&query="+encodeURIComponent("SELECT (GROUP_CONCAT(?eb) AS ?eb) (GROUP_CONCAT(?rb) AS ?rb) ?pmid (GROUP_CONCAT(?increased) AS ?increased) WHERE {?protein wdt:P352 '"+e+"'.?protein p:P5572+ ?claim.?claim ps:P5572 ?form.?claim prov:wasDerivedFrom/pr:P248/wdt:P698 ?pmid.BIND(IF(?form = wd:Q51955212, '+', '') AS ?eb).BIND(IF(?form = wd:Q51955198, '+', '') AS ?rb).OPTIONAL {?protein wdt:P1911 ?form.BIND(IF(?form = wd:Q51955212, 'eb', 'rb') AS ?increased).}}GROUP BY ?pmid");return t.get(r).success(function(e){return e.data}).error(function(e){return e})}}}]),angular.module("resources").factory("allOrgGenes",["$http",function(t){var n="https://query.wikidata.org/sparql?format=json&query=";return{getAllOrgGenes:function(e){var r=n+encodeURIComponent("SELECT REDUCED ?gene ?geneLabel ?entrez ?locusTag WHERE { ?taxon wdt:P685 '"+e+"'. ?gene wdt:P703 ?taxon;       wdt:P279|wdt:P31 wd:Q7187. OPTIONAL{?gene wdt:P2393 ?locusTag.}OPTIONAL {?gene wdt:P351 ?entrez.} SERVICE wikibase:label {bd:serviceParam wikibase:language 'en' . }}ORDER BY ASC(?locusTag)");return t.get(r).success(function(e){return e}).error(function(e){return e})},getAllChromosomeGenes:function(e){var r=n+encodeURIComponent("SELECT REDUCED ?gene ?geneLabel ?entrez ?locusTag WHERE {   ?chromosome wdt:P2249 '"+e+"'.   ?gene p:P644/pq:P1057 ?chromosome.   OPTIONAL { ?gene wdt:P2393 ?locusTag. }   OPTIONAL { ?gene wdt:P351 ?entrez. }   SERVICE wikibase:label { bd:serviceParam wikibase:language 'en'. }}ORDER BY ?locusTag");return t.get(r).success(function(e){return e}).error(function(e){return e})}}}]),angular.module("resources").factory("allSpeciesGenes",["$http",function(t){return{getAllSpeciesGenes:function(e){var r="https://query.wikidata.org/sparql?format=json&query="+encodeURIComponent("SELECT REDUCED ?taxid ?taxonLabel ?gene ?geneLabel ?geneAltLabel ?locusTag ?entrez ?uniprot ?refseq_prot ?pdb ?mfLabel ?bpLabel ?ccLabel ?host_proteinLabel WHERE {?taxon (wdt:P171*/wdt:P685) '"+e+"';   wdt:P685 ?taxid.?gene wdt:P703 ?taxon;   (wdt:P279|wdt:P31) wd:Q7187.OPTIONAL{?gene wdt:P2393 ?locusTag.}OPTIONAL {?gene wdt:P351 ?entrez}SERVICE wikibase:label { bd:serviceParam wikibase:language 'en'. }}");return t.get(r).success(function(e){var r=e.results.bindings,a=/(\w{2,4})_?(RS)?\d+/;return angular.forEach(r,function(e){var r=e.geneLabel.value,t=r.match(a)[0];-1!=r.indexOf("_")&&(e.geneLabel.value+="/"+t.replace("_",""));var n=t.match(/(\w{2,4})_?(RS)?/)[0],o=parseInt(t.substring(n.length));e.geneLabel.value+="/"+n+o,-1!=n.indexOf("_")&&(e.geneLabel.value+="/"+n.replace("_","")+o)}),r}).error(function(e){return e})},getAllSpeciesGeneLabels:function(e){var r="https://query.wikidata.org/sparql?format=json&query="+encodeURIComponent("SELECT DISTINCT ?geneLabel ?locusTag ?taxid ?symbol ?entrez WHERE { ?taxon wdt:P171+/wdt:P685 '"+e+"'.?gene wdt:P703 ?taxon;wdt:P279|wdt:P31 wd:Q7187.?taxon wdt:P685 ?taxid. OPTIONAL{?gene wdt:P2393 ?locusTag.}OPTIONAL {?gene wdt:P2561 ?symbol}OPTIONAL {?gene wdt:P351 ?entrez}SERVICE wikibase:label { bd:serviceParam wikibase:language 'en'. }}");return t.get(r).success(function(e){var r=e.results.bindings,s=/(\w{2,4})_?(RS)?\d+/;return angular.forEach(r,function(e){var r=e.geneLabel.value,t=r.match(s)[0];-1!=r.indexOf("_")&&(e.geneLabel.value+="/"+t.replace("_",""));var n=t.match(/(\w{2,4})_?(RS)?/)[0],o=parseInt(t.substring(n.length));if(e.geneLabel.value+="/"+n+o,-1!=n.indexOf("_")&&(e.geneLabel.value+="/"+n.replace("_","")+o),e.symbol){var a=e.symbol.value;-1==e.geneLabel.value.toLowerCase().indexOf(a.toLowerCase())&&(e.geneLabel.value+=" ("+a+")")}}),r}).error(function(e){return e})}}}]),angular.module("resources").factory("wdGetEntities",function(){return{wdGetEntities:function(e){return $.ajax({url:"https://www.wikidata.org/w/api.php",jsonp:"callback",dataType:"jsonp",data:{action:"wbgetentities",ids:e,format:"json"},xhrFields:{withCredentials:!0},success:function(e){return e},error:function(e){return e}})}}}),angular.module("resources").factory("entrez2QID",["$http",function(n){return{getQID:function(e,r){var t="https://query.wikidata.org/sparql?format=json&query="+encodeURIComponent("SELECT distinct ?gene ?protein WHERE{?gene wdt:P351 '{entrez}'. OPTIONAL {?gene wdt:P688 ?protein.}}".replace("{entrez}",e));return n.get(t).success(function(e){return e}).error(function(e){return e})}}}]),angular.module("resources").factory("locusTag2QID",["$http",function(o){return{getQID:function(e,r){var t="SELECT distinct ?gene ?protein WHERE{?strain wdt:P685 '{taxid}'. ?gene wdt:P2393 '{locusTag}'; wdt:P703 ?strain. OPTIONAL {?gene wdt:P688 ?protein.}}".replace("{taxid}",r).replace("{locusTag}",e),n="https://query.wikidata.org/sparql?format=json&query="+encodeURIComponent(t);return o.get(n).success(function(e){return e}).error(function(e){return e})}}}]),angular.module("resources").factory("abstractSPARQL",["$http",function(a){return{getAbstractSPARQL:function(e,r,t){var n="PREFIX wd: <https://www.wikidata.org/entity/> PREFIX prov: <https://www.w3.org/ns/prov#> PREFIX pr: <https://www.wikidata.org/prop/reference/> PREFIX p: <https://www.wikidata.org/prop/> PREFIX ps: <https://www.wikidata.org/prop/statement/> SELECT (wd:prot_qid as ?sub) ?obj ?objLabel ?objDescription ?obj_id ?stated_in ?stated_inLabel ?retrieved ?reference_url ?language ?languageLabel ?curator ?curatorLabel ?determination ?determinationLabel WHERE {  wd:prot_qid p:an_prop ?claim .  ?claim ps:an_prop ?obj.  ?obj wdt:id_prop ?obj_id.   optional {?claim prov:wasDerivedFrom/pr:P248 ?stated_in. }   optional {?claim prov:wasDerivedFrom/pr:P813 ?retrieved. }   optional {?claim prov:wasDerivedFrom/pr:P854 ?reference_url. }   optional {?claim prov:wasDerivedFrom/pr:P407 ?language. }   optional {?claim prov:wasDerivedFrom/pr:P1640 ?curator. }   optional {?claim pq:P459 ?determination. }   SERVICE wikibase:label {         bd:serviceParam wikibase:language 'en' .  } }".replace(/prot_qid/g,e).replace(/an_prop/g,r).replace(/id_prop/g,t),o="https://query.wikidata.org/sparql?format=json&query="+encodeURIComponent(n);return console.log(n),a.get(o).success(function(e){return e}).error(function(e){return e})}}}]);angular.module("advancedKeywordForm",["resources"]);angular.module("advancedSearchFilter",["resources"]);angular.module("advSearchPage",["resources"]);angular.module("allgenesDownload",[]);angular.module("browserPage",["resources"]);angular.module("footer",[]);angular.module("oauthForm",["resources"]);angular.module("oauthView",["resources"]);angular.module("header",[]);angular.module("organismForm",["resources"]);angular.module("keywordForm",["resources"]);angular.module("jbrowseView",["resources"]);angular.module("landingPage",["resources"]);angular.module("organismTree",["resources"]);angular.module("alignmentView",[]);angular.module("annotationsView",["resources","cellVisualizer","helpForm"]);angular.module("enzymeView",[]);angular.module("expressionView",[]);angular.module("geneOntology",[]);angular.module("interPro",[]);angular.module("linkedPubs",[]);angular.module("localizationView",[]);angular.module("mutantsView",["resources"]);angular.module("operonAnnotations",[]);angular.module("orthologView",["resources"]);angular.module("hostPathogen",[]);angular.module("proteinView",[]);angular.module("localizationForm",[]);angular.module("geneNameForm",["resources"]);angular.module("geneSymbolForm",[]);angular.module("goForm",["resources"]);angular.module("helpForm",["resources"]);angular.module("mutantBatch",["resources"]);angular.module("mutantForm",["resources"]);angular.module("operonForm",["resources"]);angular.module("pdbForm",["resources"]);angular.module("hostpathForm",["resources"]);angular.module("cellVisualizer",[]);angular.module("geneOverview",["resources"]);angular.module("mainPage",["resources"]);angular.module("organismView",["resources"]);angular.module("advancedKeywordForm").component("advancedKeywordForm",{controller:["$cacheFactory","allGoTerms","$location","allSpeciesGenes","appData",function(e,t,a,o,n){var l=this;n.getAppData(function(t){o.getAllSpeciesGeneLabels(t.parent_taxid).then(function(e){l.genes=e.data.results.bindings}),l.locusTag=t.example_locus_tag,l.onSelect=function(e){"locus_tag"==t.primary_identifier?a.path("/organism/"+e.taxid.value+"/gene/"+e.locusTag.value):a.path("/organism/"+e.taxid.value+"/gene/"+e.entrez.value)}}),l.submitKeyword=function(e){null==e?a.path("keyword/"):a.path("keyword/"+e)},l.scrolled=!1,l.keyPressed=function(e){l.keyword=l.keyword.replace("/"," "),13==e.keyCode?l.scrolled?l.onSelect(l.selected):l.geneList&&1==l.geneList.length?l.onSelect(l.geneList[0]):l.submitKeyword(l.keyword):37<=e.keyCode&&e.keyCode<=40&&(l.scrolled=!0)},l.select=function(e,t){l.selected=e,"click"==t.type&&l.onSelect(e)},l.advSearch=function(){l.storeCache(),l.keyword||(l.keyword=""),a.path("keyword/"+l.keyword)}}],templateUrl:"/static/build/js/angular_templates/advanced-keyword-form.min.html"});angular.module("advancedSearchFilter").component("advancedSearchFilter",{controller:["$cacheFactory","allGoTerms","allOrgs",function(e,r,t){var n=this,a=e.get("advSearch");a?(n.mf=a.get("mf")[0],n.mftext=a.get("mf")[1],n.bp=a.get("bp")[0],n.bptext=a.get("bp")[1],n.cc=a.get("cc")[0],n.cctext=a.get("cc")[1],n.hp=a.get("hp")[0],n.hptext=a.get("hp")[1],n.entrez=a.get("entrez")[0],n.entreztext=a.get("entrez")[1],n.uniprot=a.get("uniprot")[0],n.uniprottext=a.get("uniprot")[1],n.refseq=a.get("refseq")[0],n.refseqtext=a.get("refseq")[1],n.pdb=a.get("pdb")[0],n.pdbtext=a.get("pdb")[1],n.operon=a.get("operon")[0],n.operontext=a.get("operon")[1],n.cm=a.get("cm"),n.tm=a.get("tm"),n.im=a.get("im"),n.rm=a.get("rm"),n.rb=a.get("rb"),n.eb=a.get("eb"),n.bacp=a.get("bacp")[0],n.bacptext=a.get("bacp")[1],n.orgData=a.get("orgs"),n.constitutive=a.get("constitutive"),n.early=a.get("early"),n.mid=a.get("mid"),n.midlate=a.get("midlate"),n.late=a.get("late"),n.verylate=a.get("verylate")):(n.orgData=[],t.getAllOrgs(function(t){angular.forEach(t,function(t){t.check=!0,n.orgData.push(t)})}));var p={name:"Molecular Function",QID:"Q14860489"},c={name:"Cellular Component",QID:"Q5058355"},o={name:"Biological Process",QID:"Q2996394"};n.mfTerms=function(t){return r.getGoTermsAll(t,p.QID).then(function(t){return t.data.results.bindings.map(function(t){return t})})},n.ccTerms=function(t){return r.getGoTermsAll(t,c.QID).then(function(t){return t.data.results.bindings.map(function(t){return t})})},n.bpTerms=function(t){return r.getGoTermsAll(t,o.QID).then(function(t){return t.data.results.bindings.map(function(t){return t})})},n.storeCache=function(){var t=e.get("advSearch");null==t&&(t=e("advSearch")),t.put("mf",[n.mf,n.mftext]),t.put("bp",[n.bp,n.bptext]),t.put("cc",[n.cc,n.cctext]),t.put("hp",[n.hp,n.hptext]),t.put("entrez",[n.entrez,n.entreztext]),t.put("uniprot",[n.uniprot,n.uniprottext]),t.put("refseq",[n.refseq,n.refseqtext]),t.put("pdb",[n.pdb,n.pdbtext]),t.put("operon",[n.operon,n.operontext]),t.put("cm",n.cm),t.put("tm",n.tm),t.put("im",n.im),t.put("rm",n.rm),t.put("rb",n.rb),t.put("eb",n.eb),t.put("bacp",[n.bacp,n.bacptext]),t.put("constitutive",n.constitutive),t.put("early",n.early),t.put("mid",n.mid),t.put("midlate",n.midlate),t.put("late",n.late),t.put("verylate",n.verylate),t.put("orgs",n.orgData)}}],templateUrl:"/static/build/js/angular_templates/advanced-search-filter.min.html",bindings:{mf:"=?",mftext:"=?",bp:"=?",bptext:"=?",cc:"=?",cctext:"=?",hp:"=?",hptext:"=?",entrez:"=?",entreztext:"=?",uniprot:"=?",uniprottext:"=?",refseq:"=?",refseqtext:"=?",pdb:"=?",pdbtext:"=?",operon:"=?",operontext:"=?",bacp:"=?",bacptext:"=?",cm:"=?",tm:"=?",im:"=?",rm:"=?",rb:"=?",eb:"=?",constitutive:"=?",early:"=?",mid:"=?",midlate:"=?",late:"=?",verylate:"=?",orgData:"=?",storeCache:"=?"}});angular.module("advSearchPage").component("advSearchPage",{controller:["$location","$filter","allSpeciesGenes","queryBuilder","$http","allGoTerms","sendToView","$cacheFactory","appData","NgTableParams","expressionTimingData","concatenator","$timeout",function(a,l,e,n,i,t,r,o,s,p,u,c,d){"use strict";var b=this;b.$onInit=function(){b.speciesGenes={},b.tableParams=new p,b.longTitle=function(e){return 80<e.length?e:""},b.keyword=a.path().split("/")[2],b.keywordResult=b.keyword,b.adv_cache=o.get("advSearch"),s.getAppData(function(t){b.appData=t,b.onSelect=function(e){"locus_tag"==t.primary_identifier?a.path("/organism/"+e.taxid.value+"/gene/"+e.locusTag.value):a.path("/organism/"+e.taxid.value+"/gene/"+e.entrez.value)}}),b.advSearch=function(){b.loading=!0,b.storeCache(),b.keywordResult=b.keyword;s.getAppData(function(e){var t="https://query.wikidata.org/sparql?format=json&query="+encodeURIComponent(b.buildQuery(e.parent_taxid));i.get(t).then(function(e){b.speciesGenes.allGenes=c.concatenate(e.data.results.bindings),b.speciesGenes.keywordAll=l("keywordFilter")(b.speciesGenes.allGenes,b.keyword),b.currentOrgsList=[],angular.forEach(b.orgData,function(e){1==e.check&&b.currentOrgsList.push(e.taxid)}),b.speciesGenes.keywordAll=l("deleteJsonItemValuesList")("taxid",b.currentOrgsList,b.speciesGenes.keywordAll);var t="organism/1/gene/1/mg_mutant_view",n=0;if(b.cm&&n++,b.tm&&n++,b.im&&n++,b.rm&&n++,(b.constitutive||b.early||b.mid||b.midlate||b.late||b.verylate)&&n++,0==n)return b.tableParams.settings({dataset:b.speciesGenes.keywordAll}),void(b.loading=!1);(b.constitutive||b.early||b.mid||b.midlate||b.late||b.verylate)&&u.getExpression(function(e){var t=[],a=[];if(b.constitutive&&a.push("Constitutive"),b.early&&a.push("Early"),b.mid&&a.push("Mid"),b.midlate&&a.push("Mid_Late"),b.late&&a.push("Late"),b.verylate&&a.push("Very_Late"),angular.forEach(e,function(e){-1!=a.indexOf(e.RB_EXPRESSION_TIMING)&&t.push(e["Locus tag"])}),b.speciesGenes.keywordAll=l("locusTagFilter")(b.speciesGenes.keywordAll,t),0==--n)return b.tableParams.settings({dataset:b.speciesGenes.keywordAll}),void(b.loading=!1)}),b.cm&&r.sendToView(t,{action:"chemical"}).then(function(e){var t=e.data.mutants,a=[];if(angular.forEach(t,function(e){-1==a.indexOf(e.locusTag)&&a.push(e.locusTag)}),b.speciesGenes.keywordAll=l("locusTagFilter")(b.speciesGenes.keywordAll,a),0==--n)return b.tableParams.settings({dataset:b.speciesGenes.keywordAll}),void(b.loading=!1)}),b.tm&&r.sendToView(t,{action:"transposition"}).then(function(e){var t=e.data.mutants,a=[];if(angular.forEach(t,function(e){-1==a.indexOf(e.locusTag)&&a.push(e.locusTag)}),b.speciesGenes.keywordAll=l("locusTagFilter")(b.speciesGenes.keywordAll,a),0==--n)return b.tableParams.settings({dataset:b.speciesGenes.keywordAll}),void(b.loading=!1)}),b.rm&&r.sendToView(t,{action:"recombination"}).then(function(e){var t=e.data.mutants,a=[];if(angular.forEach(t,function(e){-1==a.indexOf(e.locusTag)&&a.push(e.locusTag)}),b.speciesGenes.keywordAll=l("locusTagFilter")(b.speciesGenes.keywordAll,a),0==--n)return b.tableParams.settings({dataset:b.speciesGenes.keywordAll}),void(b.loading=!1)}),b.im&&r.sendToView(t,{action:"insertion"}).then(function(e){var t=e.data.mutants,a=[];if(angular.forEach(t,function(e){-1==a.indexOf(e.locusTag)&&a.push(e.locusTag)}),b.speciesGenes.keywordAll=l("locusTagFilter")(b.speciesGenes.keywordAll,a),0==--n)return b.tableParams.settings({dataset:b.speciesGenes.keywordAll}),void(b.loading=!1)})},function(e){console.log("Error with query"),console.log(e),b.loading=!1})})},(b.adv_cache||""!=b.keyword)&&d(b.advSearch,500)},b.startJS=function(){$(".collapse").collapse("show");var e=introJs().setOption("skipLabel","Exit");e.setOption("showStepNumbers","false"),e.hideHints(),e.start()},b.buildQuery=function(e){var t=n.beginning(e);"locus_tag"==b.appData.primary_identifier&&(t+=n.triple("?gene","locusTag","?locusTag")),(b.entrez||"entrez"==b.appData.primary_identifier)&&(b.entreztext&&b.entrez?t+=n.equals("?gene","entrez",b.entreztext):t+=n.triple("?gene","entrez","?entrez")),b.operon&&(t+=n.triple("?gene","partOf","?operon"),b.operontext&&(t+=n.triple("?operon","hasPart","?operonGenes"),t+=n.triple("?operonGenes","locusTag","?opLocusTags"),t+=n.filter("?opLocusTags",b.operontext)));var a="";return b.uniprot&&(b.uniprottext?a+=n.equals("?protein","uniprot",b.uniprottext):a+=n.triple("?protein","uniprot","?uniprot")),b.pdb&&(b.pdbtext?a+=n.equals("?protein","pdb",b.pdbtext.toUpperCase()):a+=n.triple("?protein","pdb","?pdb")),b.refseq&&(b.refseqtext?a+=n.equals("?protein","refseq",b.refseqtext):a+=n.triple("?protein","refseq","?refseq")),b.rb&&(a+=n.triple("?protein","db","wd:Q51955198")),b.eb&&(a+=n.triple("?protein","db","wd:Q51955212")),b.mf&&(a+=n.addLabel("?protein","mf","?mfLabel"),a+=n.filterEnglish("?mfLabel")),b.bp&&(a+=n.addLabel("?protein","bp","?bpLabel"),a+=n.filterEnglish("?bpLabel")),b.cc&&(a+=n.addLabel("?protein","cc","?ccLabel"),a+=n.filterEnglish("?ccLabel")),(b.hp||b.bacp)&&(a+=n.triple("?protein","hp","?host_protein")),b.hp&&b.bacp||(b.hp?a+=n.minus(n.triple("?host_protein","taxon","?taxon")):b.bacp&&(a+=n.triple("?host_protein","taxon","?taxon"))),(b.uniprot||b.refseq||b.mf||b.bp||b.cc||b.hp||b.bacp||b.pdb||b.eb||b.rb)&&(t+=n.triple("?gene","protein","?protein"),t+=a),b.mf&&b.mftext&&(t+=n.filter("?mfLabel",b.mftext)),b.cc&&b.cctext&&(t+=n.filter("?ccLabel",b.cctext)),b.bp&&b.bptext&&(t+=n.filter("?bpLabel",b.bptext)),b.hp&&b.hptext&&(t+=n.filter("?host_proteinLabel",b.hptext)),b.bacp&&b.bacptext&&(t+=n.filter("?host_proteinLabel",b.bacptext)),t+=n.ending(),console.log("QUERY:"),console.log(t),t}}],templateUrl:"/static/build/js/angular_templates/advanced-search-page.min.html"}).factory("queryBuilder",function(){var n={entrez:"wdt:P351",uniprot:"wdt:P352",refseq:"wdt:P637",mf:"wdt:P680",cc:"wdt:P681",bp:"wdt:P682",protein:"wdt:P688",hp:"wdt:P129",pdb:"wdt:P638",db:"wdt:P5572",taxon:"wdt:P703",locusTag:"wdt:P2393",partOf:"wdt:P361",hasPart:"wdt:P527"};return{optional:function(e){return"OPTIONAL {\n"+e+"}\n"},filter:function(e,t){return"FILTER(CONTAINS(LCASE("+e+"), '"+t.toLowerCase()+"')).\n"},equals:function(e,t,a){return e+" "+n[t]+" '"+a+"'.\n"},filterEnglish:function(e){return"FILTER(LANG("+e+") = 'en').\n"},beginning:function(e){return"SELECT REDUCED ?taxid ?taxonLabel ?gene ?geneLabel ?geneAltLabel ?locusTag ?entrez ?uniprot ?refseq_prot ?pdb ?mfLabel ?bpLabel ?ccLabel ?host_proteinLabel WHERE {\n?taxon (wdt:P171*/wdt:P685) '"+e+"';\n   wdt:P685 ?taxid.\n?gene wdt:P703 ?taxon;\n   (wdt:P279|wdt:P31) wd:Q7187.\n"},ending:function(){return"SERVICE wikibase:label { bd:serviceParam wikibase:language 'en'. }}"},addLabel:function(e,t,a){return e+" "+n[t]+"/rdfs:label "+a+".\n"},triple:function(e,t,a){return e+" "+n[t]+" "+a+".\n"},union:function(e,t){return"{"+e+"} UNION {"+t+"}\n"},minus:function(e){return"MINUS {\n"+e+"}\n"}}}).factory("concatenator",function(){return{concatenate:function(e){var a={};angular.forEach(e,function(e){var t=e.locusTag.value;t in a?("mfLabel"in a[t]&&-1==a[t].mfLabel.value.indexOf(e.mfLabel.value)&&a[t].mfLabel.value.push(e.mfLabel.value),"bpLabel"in a[t]&&-1==a[t].bpLabel.value.indexOf(e.bpLabel.value)&&a[t].bpLabel.value.push(e.bpLabel.value),"ccLabel"in a[t]&&-1==a[t].ccLabel.value.indexOf(e.ccLabel.value)&&a[t].ccLabel.value.push(e.ccLabel.value),"host_proteinLabel"in a[t]&&-1==a[t].host_proteinLabel.value.indexOf(e.host_proteinLabel.value)&&a[t].host_proteinLabel.value.push(e.host_proteinLabel.value),"pdb"in a[t]&&-1==a[t].pdb.value.indexOf(e.pdb.value)&&a[t].pdb.value.push(e.pdb.value)):("mfLabel"in e&&(e.mfLabel.value=[e.mfLabel.value]),"bpLabel"in e&&(e.bpLabel.value=[e.bpLabel.value]),"ccLabel"in e&&(e.ccLabel.value=[e.ccLabel.value]),"host_proteinLabel"in e&&(e.host_proteinLabel.value=[e.host_proteinLabel.value]),"pdb"in e&&(e.pdb.value=[e.pdb.value]),a[t]=e)});var t=[];return angular.forEach(a,function(e){"mfLabel"in e&&(e.mfLabel.value=e.mfLabel.value.join(", ")),"bpLabel"in e&&(e.bpLabel.value=e.bpLabel.value.join(", ")),"ccLabel"in e&&(e.ccLabel.value=e.ccLabel.value.join(", ")),"host_proteinLabel"in e&&(e.host_proteinLabel.value=e.host_proteinLabel.value.join(", ")),"pdb"in e&&(e.pdb.value=e.pdb.value.join(", ")),t.push(e)}),t}}});angular.module("allgenesDownload").component("allgenesDownload",{template:'<a target="_blank" href="{{$ctrl.genesUrl()}}"><div class="btn btn-default">Download Genes</div></a>',bindings:{taxid:"<"},controller:function(){"use strict";var t=this;t.$onChanges=function(e){e.taxid&&(t.genesUrl=function(){return"https://query.wikidata.org/#SELECT ?refSeqChromosome ?gene ?genStart ?genEnd ?strand ?geneLabel ?entrez ?locusTag ?protein ?proteinLabel ?uniprot ?refseqProt WHERE{ ?taxon wdt:P685 '"+t.taxid+"'. ?gene wdt:P703 ?taxon; wdt:P279 wd:Q7187; wdt:P644 ?genStart; wdt:P645 ?genEnd; wdt:P2548 ?strand; wdt:P2393 ?locusTag; wdt:P351 ?entrez; wdt:P688 ?protein. ?protein wdt:P352 ?uniprot; wdt:P637 ?refseqProt.OPTIONAL{ ?gene p:P644 ?chr. ?chr pq:P2249 ?refSeqChromosome.} SERVICE wikibase:label { bd:serviceParam wikibase:language 'en' . } }"})}}});angular.module("browserPage").component("browserPage",{controller:["$filter","$location","$routeParams","allOrgs","allOrgGenes","appData","RefSeqChrom",function(n,l,e,a,o,t,s){"use strict";var i=this;i.$onInit=function(){i.loading=!0,i.currentTaxid=e.taxid,i.selected="",t.getAppData(function(n){i.appData=n,i.onSelect=function(e){"locus_tag"==n.primary_identifier?l.path("/organism/"+i.currentTaxid+"/gene/"+e.locusTag.value):l.path("/organism/"+i.currentTaxid+"/gene/"+e.entrez.value)},i.chromosomes=[];var a=i.numChromosomes=0,o=0;s.getAllChromosomes(i.currentTaxid).then(function(e){angular.forEach(e,function(e){5<=o&&(a++,o=0),0==o&&i.chromosomes.push([]),i.chromosomes[a].push(e),o++,i.numChromosomes++}),i.onChromSelect(i.chromosomes[0][0])}),i.plasmids=[];var t=i.numPlasmids=0,r=0;s.getAllPlasmids(i.currentTaxid).then(function(e){angular.forEach(e,function(e){5<=r&&(t++,r=0),0==r&&i.plasmids.push([]),i.plasmids[t].push(e),i.numPlasmids++,r++})})}),i.onChromSelect=function(n){i.loading=!0,i.currentAllGenes=[],o.getAllChromosomeGenes(n.refseq.value).then(function(e){i.currentAllGenes=e.data.results.bindings,n.chromosomeLabel?i.selected=n.chromosomeLabel.value:i.selected=n.plasmidLabel.value}).finally(function(){i.loading=!1,null==i.initialGene&&(i.initialGene=i.currentAllGenes[0])})},a.getAllOrgs(function(e){i.orgList=e,i.currentOrg=n("getJsonItemOrg")("taxid",i.currentTaxid,i.orgList),null==i.currentOrg&&(alert("not a valid taxonomy id"),l.path("/"))})}}],templateUrl:"/static/build/js/angular_templates/browser-page.min.html"});angular.module("footer").component("footer",{templateUrl:"/static/build/js/angular_templates/footer.min.html",controller:function(){}});angular.module("oauthForm").component("oauthForm",{controller:["$window","$routeParams","$location","sendToView","appData",function(a,i,n,t,o){"use strict";var e=this;e.authorization=n.path().includes("authorized"),o.getAppData(function(t){e.appData=t}),e.oauthAuthorization=function(){t.sendToView("/wd_oauth",{authorization:"sending",current_path:n.path(),initiate:!0}).then(function(t){a.location.href=t.data.wikimediaURL})},e.revokeAuthorization=function(){t.sendToView("/wd_oauth",{deauthenticate:!0}).then(function(t){var a="/organism/{taxid}".replace("{taxid}",i.taxid),o="/gene/{locusTag}/".replace("{locusTag}",i.locusTag);n.url(a+o)})}}],templateUrl:"/static/build/js/angular_templates/oauth-form.min.html"});angular.module("oauthView").component("oauthView",{bindings:{},controller:["$window","$routeParams","$location","sendToView",function(t,o,i,e){"use strict";o.oauth_verifier&&(e.sendToView("/wd_oauth",{url:i.url()}).then(function(t){console.log(t)}),i.url(i.path())),this.authorization=i.path().includes("authorized")}],templateUrl:"/static/build/js/angular_templates/authorization-view.min.html"});angular.module("header").component("header",{templateUrl:"/static/build/js/angular_templates/header.min.html",controller:["appData",function(a){var t=this;a.getAppData(function(a){t.appData=a})}],bindings:{oauth:"<"}});angular.module("organismForm").component("organismForm",{controller:["$location",function(o){"use strict";this.onSelect=function(n){o.path("/organism/"+n.taxid)}}],templateUrl:"/static/build/js/angular_templates/organism-form.min.html",bindings:{orgs:"<"}});angular.module("keywordForm").component("keywordForm",{controller:["$filter","$location","allSpeciesGenes","appData",function(e,l,n,t){"use strict";var o=this;o.$onInit=function(){o.selected=null,t.getAppData(function(t){n.getAllSpeciesGeneLabels(t.parent_taxid).then(function(e){o.genes=e.data.results.bindings}),o.locusTag=t.example_locus_tag,o.onSelect=function(e){"locus_tag"==t.primary_identifier?l.path("/organism/"+e.taxid.value+"/gene/"+e.locusTag.value):l.path("/organism/"+e.taxid.value+"/gene/"+e.entrez.value)}}),o.submitKeyword=function(e){null==e?l.path("keyword/"):l.path("keyword/"+e)}},o.scrolled=!1,o.keyPressed=function(e){o.keyword=o.keyword.replace("/"," "),13==e.keyCode?o.scrolled?o.onSelect(o.selected):o.geneList&&1==o.geneList.length?o.onSelect(o.geneList[0]):o.submitKeyword(o.keyword):37<=e.keyCode&&e.keyCode<=40&&(o.scrolled=!0)},o.select=function(e,t){o.selected=e,"click"==t.type&&o.onSelect(e)}}],templateUrl:"/static/build/js/angular_templates/search-bar.min.html"});angular.module("jbrowseView").component("jbrowseView",{template:'<iframe class="jbrowse" ng-src={{$ctrl.jbrowseURI()}}></iframe>',bindings:{taxid:"<",gene:"<"},controller:function(){var o=this;o.$onInit=function(){},o.$onChanges=function(){o.gene&&(o.jbrowseURI=function(){var e=Number(o.gene.genStart)-1e3,n=Number(o.gene.genEnd)+1e3,r="",t="";return e&&n&&o.gene.refseqGenome&&(r="&loc="+o.gene.refseqGenome+":"+e+".."+n,t="&highlight="+o.gene.refseqGenome+":"+Number(o.gene.genStart)+".."+Number(o.gene.genEnd)),"static/wiki/js/external_js/JBrowse-1.14.1/index.html?data="+o.taxid+"_data&tracks=DNA,genes,operons,mutants&menu=0"+r+t})}}});angular.module("landingPage").component("landingPage",{controller:["allOrgs","recentPubLinks","euroPubData","appData",function(t,e,a,n){"use strict";var o=this;n.getAppData(function(t){o.appData=t,e.getRecentPubLinks(t.newsfeed_search_term,t.newsfeed_recent_days,t.newsfeed_max_articles).then(function(t){var e=t.data.esearchresult.idlist;o.recentPubs=[],angular.forEach(e,function(t){a.getEuroPubData(t).then(function(t){t.data.resultList.result[0]&&o.recentPubs.push(t.data.resultList.result[0])})})})}),o.myInterval=5e3,o.noWrapSlides=!1,o.active=0,t.getAllOrgs(function(t){o.orgList=t}),document.getElementById("get-started").onclick=function(){var t=introJs().setOption("skipLabel","Skip Tutorial");t.setOption("showStepNumbers","false"),t.hideHints(),t.start()},window.addEventListener("load",function(){if("true"!=localStorage.getItem("tutorial")){var t=introJs().setOption("skipLabel","Skip Tutorial");t.setOption("showStepNumbers","false"),t.hideHints(),t.oncomplete(function(){console.log("COMPLETED"),localStorage.setItem("tutorial","true")}),t.onexit(function(){console.log("EXIT"),localStorage.setItem("tutorial","true")}),t.start()}else console.log("Tutorial already completed")})}],templateUrl:"/static/build/js/angular_templates/landing-page.min.html"});angular.module("organismTree").component("organismTree",{controller:["orgTree",function(a){"use strict";var e=this;e.$onInit=function(){google.charts.load("current",{packages:["orgchart"]}),google.charts.setOnLoadCallback(function(){e.data=new google.visualization.DataTable,e.data.addColumn("string","Name"),e.data.addColumn("string","Parent"),a.getOrgTree(function(a){var t;e.data.addRows(a.data),t=new google.visualization.OrgChart(document.getElementById("chart_div")),console.log(t),t.draw(e.data,{allowHtml:!0,size:"medium"})})})}}],templateUrl:"/static/build/js/angular_templates/organism-tree.min.html",bindings:{orgs:"<"}});angular.module("alignmentView").controller("alignmentCtrl",["orthoDataByLocusTag","orthoDataByEntrez","appData","geneSequenceData","alignOrthologData","proteinSequenceData","taxidFilter","$routeParams",function(n,a,e,o,i,l,t,s){"use strict";var r=this;t.map().then(function(e){r.tax2Name=e}),r.projection={},r.type="dna",r.alignMessage="Aligning Orthologs. Please be patient.",r.citation=!1,r.isRendered=!1,r.data={},e.getAppData(function(e){var t=n;"entrez"==e.primary_identifier&&(t=a),t.getOrthologs(s.locusTag).then(function(e){angular.forEach(e.results.bindings,function(e){var t=e.orthoTaxid.value,n=e.orthoLocusTag.value;r.hasOrthologs=!0,r.projection[t]=!0;var a=e.refseq?e.refseq.value:"";r.data[t]=[n,a]})})}),r.select=function(e,t){r.projection[t]=e},r.alignData=function(){var n=[],a=0;angular.forEach(r.projection,function(e,t){e?("dna"==r.type?o.getSequence(r.data[t][0]):l.getSequence(r.data[t][1])).then(function(e){a++,n.push(e),a==Object.keys(r.projection).length&&(r.aligning=!0,i.align(n,r),r.citation=!0)},function(e){a++,r.aligning=!1}):a++})}}]).factory("alignOrthologData",["$http","$timeout","$sce",function(e,i,l){"use strict";var s=function(a,o){e.get("https://www.ebi.ac.uk/Tools/services/rest/muscle/status/"+a).then(function(e){if(console.log(e.data),"RUNNING"!=e.data)if("FINISHED"==e.data){o.aligning=!1;var t={el:document.getElementById("msaDiv"),vis:{conserv:!0,seqlogo:!1,labelId:!1},zoomer:{labelNameLength:110},colorscheme:{scheme:"clustal2"}},n=new msa.msa(t);n.u.file.importURL("https://www.ebi.ac.uk/Tools/services/rest/muscle/result/"+a+"/aln-fasta",function(){n.render()}),new msa.menu.defaultmenu({el:document.getElementById("menuDiv"),msa:n}).render(),o.isRendered=!0,o.alignmentURL=l.trustAsResourceUrl("https://www.ebi.ac.uk/Tools/services/rest/muscle/result/"+a+"/aln-fasta")}else console.log("ERROR: "+e.data),o.aligning=!1;else i(s(a,o),2e3)})};return{align:function(a,o){e.get("alignOrthologs?sequence="+encodeURIComponent(a.join("\n"))+"&length="+encodeURIComponent(a.length)).then(function(e){var t=e.data.id;console.log("Job ID:"+t),s(t,o)},function(e){o.aligning=!1,console.log("POST TO MUSCLE Error"+e.status),console.log(e);var t=msa.io.fasta.parse(a.join("\n")),n={el:document.getElementById("msaDiv"),seqs:t};new msa.msa(n).render(),o.isRendered=!0})}}}]).component("alignmentView",{controller:"alignmentCtrl",templateUrl:"/static/build/js/angular_templates/alignment-view.min.html",bindings:{locusTag:"<",taxId:"<"}});angular.module("annotationsView").component("annotationsView",{templateUrl:"/static/build/js/angular_templates/annotations-view.min.html",bindings:{data:"<",annotations:"<",org:"<",allorggenes:"<",hasprotein:"<"},controller:["annotationSettings",function(t){"use strict";var i=this;i.settings={product:!0,ortholog:!0,alignment:!0,expression:!0,go:!0,localizations:!0,operon:!0,interpro:!0,enzyme:!0,mutants:!0,hostpath:!0,pubs:!0},i.map={product:"Gene Product",ortholog:"Orthologs",alignment:"Alignments",expression:"Expression",go:"Functions",localizations:"Localizations",operon:"Operons",interpro:"Interpro",enzyme:"Enzyme",mutants:"Mutants",hostpath:"Protein Interactions",pubs:"Related Pubs"},t.getSettings().then(function(t){i.settings={product:i.settings.product&&t.data["protein-view"],ortholog:i.settings.ortholog&&t.data["ortholog-view"],alignment:i.settings.alignment&&t.data["alignment-view"],expression:i.settings.expression&&t.data["expression-view"],go:i.settings.go&&t.data["function-view"],localizations:i.settings.localizations&&t.data["localization-view"],operon:i.settings.operon&&t.data["operon-view"],interpro:i.settings.interpro&&t.data["interpro-view"],enzyme:i.settings.enzyme&&t.data["enzyme-view"],mutants:i.settings.mutants&&t.data["mutant-view"],hostpath:i.settings.hostpath&&t.data["protein-interaction-view"],pubs:i.settings.pubs&&t.data["related-publication-view"]},i.table=[];var o=0,e=0;angular.forEach(i.settings,function(t,n){t&&(0!=e&&e%6==0&&o++,i.table[o]?i.table[o].push(n):i.table[o]=[n],e++)})}),i.$onChanges=function(t){t.hasprotein&&0==t.hasprotein.currentValue&&(i.settings.product=!1,i.settings.go=!1,i.settings.localizations=!1,i.settings.interpro=!1,i.settings.enzyme=!1,i.settings.hostpath=!1)},i.$onInit=function(){i.expandAll=function(){i.toggleOpen(!0)},i.collapseAll=function(){i.toggleOpen(!1)},i.accordion={go:!0,operon:!0,interpro:!0,enzyme:!0,mutants:!0,pubs:!0,product:!0,ortholog:!0,alignment:!0,expression:!0,hostpath:!0,localizations:!0},i.toggleOpen=function(t){i.accordion.go=t,i.accordion.operon=t,i.accordion.interpro=t,i.accordion.enzyme=t,i.accordion.mutants=t,i.accordion.pubs=t,i.accordion.product=t,i.accordion.ortholog=t,i.accordion.alignment=t,i.accordion.hostpath=t,i.accordion.expression=t,i.accordion.localizations=t},i.status={isCustomHeaderOpen:!1,isFirstOpen:!0,isFirstDisabled:!1}}}]});angular.module("enzymeView").component("enzymeView",{templateUrl:"/static/build/js/angular_templates/enzyme-view.min.html",bindings:{reaction:"<",ecnumber:"<"},controller:function(){"use strict";this.$onInit=function(){}}});angular.module("expressionView").component("expressionView",{templateUrl:"/static/build/js/angular_templates/expression-view.min.html",bindings:{data:"<",gene:"<"},controller:["$location",function(t){"use strict";this.$onInit=function(){},this.checkAuthorization=function(e){t.path().includes("authorized")?$("#"+e).modal("show"):alert("Please authorize ChlamBase to edit Wikidata on your behalf!")}}]});angular.module("geneOntology").component("geneOntology",{templateUrl:"/static/build/js/angular_templates/gene-ontology-view.min.html",bindings:{data:"<",goclass:"@",gene:"<"},controller:["$location",function(e){"use strict";var r=this;r.$onChanges=function(){r.data&&angular.forEach(r.data,function(e){e.determinationLabel.values=e.determinationLabel.value.split(";")})},r.checkAuthorization=function(){e.path().includes("authorized")?$("#"+r.goclass+"_button").modal("show"):alert("Please authorize ChlamBase to edit Wikidata on your behalf!")},r.evidenceCodes={IEA:"Inferred From Electronic Annotation",EXP:"Inferred from Experiment",IDA:"Inferred from Direct Assay",IPI:"Inferred From Physical Interaction",IMP:"Inferred from Mutant Phenotype",IGI:"Inferred from Genetic Interaction",IEP:"Inferred from Expression Pattern",ISS:"Inferred From Sequence or structural Similarity",ISO:"Inferred from Sequence Orthology",ISA:"Inferred from Sequence Alignment",ISM:"Inferred From Sequence Model",IGC:"Inferred from Genomic Context",IBA:"Inferred from Biological aspect of Ancestor",IBD:"Inferred from Biological aspect of Descendant",IKR:"Inferred From Key Residues",IRD:"Inferred from Rapid Divergence",RCA:"Inferred from Reviewed Computational Analysis",TAS:"Traceable Author Statement",NAS:"Non traceable author statement",IC:"Inferred by Curator",ND:"No biological Data available"}}]});angular.module("interPro").component("interPro",{templateUrl:"/static/build/js/angular_templates/interpro-view.min.html",bindings:{data:"<"},controller:function(){"use strict";this.$onInit=function(){}}});angular.module("linkedPubs").component("linkedPubs",{templateUrl:"/static/build/js/angular_templates/linked-pubs.min.html",bindings:{pubs:"<"},controller:function(){"use strict";this.$onInit=function(){}}});angular.module("localizationView").component("localizationView",{templateUrl:"/static/build/js/angular_templates/localization-view.min.html",bindings:{components:"<",localizations:"<",gene:"<"},controller:["$location",function(r){"use strict";var e=this;e.$onChanges=function(){e.components&&angular.forEach(e.components,function(e){e.determinationLabel.values=e.determinationLabel.value.split(";")})},e.checkAuthorization=function(e){r.path().includes("authorized")?$("#"+e).modal("show"):alert("Please authorize ChlamBase to edit Wikidata on your behalf!")},e.evidenceCodes={IEA:"Inferred From Electronic Annotation",EXP:"Inferred from Experiment",IDA:"Inferred from Direct Assay",IPI:"Inferred From Physical Interaction",IMP:"Inferred from Mutant Phenotype",IGI:"Inferred from Genetic Interaction",IEP:"Inferred from Expression Pattern",ISS:"Inferred From Sequence or structural Similarity",ISO:"Inferred from Sequence Orthology",ISA:"Inferred from Sequence Alignment",ISM:"Inferred From Sequence Model",IGC:"Inferred from Genomic Context",IBA:"Inferred from Biological aspect of Ancestor",IBD:"Inferred from Biological aspect of Descendant",IKR:"Inferred From Key Residues",IRD:"Inferred from Rapid Divergence",RCA:"Inferred from Reviewed Computational Analysis",TAS:"Traceable Author Statement",NAS:"Non traceable author statement",IC:"Inferred by Curator",ND:"No biological Data available"}}]});angular.module("mutantsView").component("mutantsView",{bindings:{data:"<"},controller:["$location","sendToView","NgTableParams","$filter",function(n,e,a,t){"use strict";var i=this;i.checkAuthorization=function(a){n.path().includes("authorized")?$("#"+a).modal("show"):alert("Please authorize ChlamBase to edit Wikidata on your behalf!")},i.$onInit=function(){},i.authorized=n.path().includes("authorized"),i.deleteAnnotation=function(a){console.log(a),i.loading=!0,a.action="delete";var t=n.path()+"/wd_mutant_edit";e.sendToView(t,a).then(function(a){}).finally(function(){i.loading=!1})},i.chemParams=new a({},{}),i.transParams=new a({},{}),i.intronParams=new a({},{}),i.recombParams=new a({},{}),i.$onChanges=function(){if(i.data){var n=[];angular.forEach(i.data,function(a){var t=a;t.start=parseInt(a.coordinate.start),t.end=parseInt(a.coordinate.end),n.push(t)}),i.chemParams=new a({},{dataset:t("filter")(n,"EFO_0000370")}),i.transParams=new a({},{dataset:t("filter")(n,"EFO_0004021")}),i.intronParams=new a({},{dataset:t("filter")(n,"EFO_0004016")}),i.recombParams=new a({},{dataset:t("filter")(n,"EFO_0004293")})}}}],templateUrl:"/static/build/js/angular_templates/mutants-view.min.html"});angular.module("operonAnnotations").component("operonAnnotations",{templateUrl:"/static/build/js/angular_templates/operon-view.min.html",bindings:{operon:"<",allorggenes:"<",gene:"<"},controller:["NgTableParams","$location",function(a,n){var o=this;o.checkAuthorization=function(a){n.path().includes("authorized")?$("#"+a).modal("show"):alert("Please authorize ChlamBase to edit Wikidata on your behalf!")},o.$onChanges=function(){if(o.operon){var n=[];angular.forEach(o.operon,function(a){var o={};angular.forEach(a,function(a,n){a.value===parseInt(a.value)?o[n]=parseInt(a.value):o[n]=a.value}),n.push(o)}),o.tableParams=new a({page:1,count:10},{dataset:n})}}}]});angular.module("orthologView").component("orthologView",{bindings:{locusTag:"<"},controller:"orthologCtrl",templateUrl:"/static/build/js/angular_templates/ortholog-view.min.html"}).controller("orthologCtrl",["orthoDataByLocusTag","orthoDataByEntrez","appData","$routeParams","InterPro","hostPathogen","GOTerms","OperonData","expressionTimingData","$filter","sendToView","$location","taxidFilter",function(e,o,t,n,i,u,l,s,h,g,d,c,a){"use strict";var p=this;a.map().then(function(t){p.tax2Name=t}),p.data={},p.reference="",t.getAppData(function(a){var t=e;"entrez"==a.primary_identifier&&(t=o),t.getOrthologs(n.locusTag).then(function(t){angular.forEach(t.results.bindings,function(r){p.hasOrthologs=!0,p.data[r.orthoTaxid.value]={locusTag:r.orthoLocusTag.value,taxid:r.orthoTaxid.value},r.reference&&(p.reference=r.reference.value),r.uniprot?(i.getInterPro(r.uniprot.value).then(function(t){p.data[r.orthoTaxid.value].ip=0<t.length}),u.getHostPathogen(r.uniprot.value).then(function(t){p.data[r.orthoTaxid.value].hp=0<t.length}),l.getGoTerms(r.uniprot.value).then(function(t){var a=t.data.results.bindings;p.data[r.orthoTaxid.value].go=0<a.length;var e=[];angular.forEach(a,function(t,a){t.hasOwnProperty("ecnumber")&&-1==e.indexOf(t.ecnumber.value)&&e.push(t.ecnumber.value)});var o={locusTag:r.orthoLocusTag.value,taxid:r.orthoTaxid.value,ec_number:e},n=c.path()+"/mg_mutant_view";d.sendToView(n,o).then(function(t){p.data[r.orthoTaxid.value].mutant=0<t.data.mutants.length})})):(p.data[r.orthoTaxid.value].ip=!1,p.data[r.orthoTaxid.value].hp=!1,p.data[r.orthoTaxid.value].go=!1),"locus_tag"==a.primary_identifier?s.getOperonDataByLocusTag(r.orthoLocusTag.value).then(function(t){p.data[r.orthoTaxid.value].operon=0<t.data.results.bindings.length}):s.getOperonDataByLocusTag(r.entrez.value).then(function(t){p.data[r.orthoTaxid.value].operon=0<t.data.results.bindings.length}),h.getExpression(function(t){var a=g("keywordFilter")(t,r.orthoLocusTag.value),e={};angular.forEach(a[0],function(t,a){"_id"!=a&&"$oid"!=a&&"timestamp"!=a&&(e[a]=t)}),p.data[r.orthoTaxid.value].expression=null!=e.RB_EXPRESSION_TIMING})})})}),p.tSettings={strain:!0,tax:!0,cLocus:!0,dLocus:!1,identity:!1,length:!1,eval:!1,ref:!0,expression:!0,go:!0,operons:!0,mutants:!0,interpro:!0,hostPathogen:!0}}]);angular.module("hostPathogen").component("hostPathogen",{templateUrl:"/static/build/js/angular_templates/protein-interactions-view.min.html",bindings:{data:"<"},controller:["$location",function(a){"use strict";this.checkAuthorization=function(t){a.path().includes("authorized")?$("#"+t).modal("show"):alert("Please authorize ChlamBase to edit Wikidata on your behalf!")}}]});angular.module("proteinView").component("proteinView",{templateUrl:"/static/build/js/angular_templates/protein-view.min.html",controller:["$location",function(e){"use strict";this.checkAuthorization=function(t){e.path().includes("authorized")?$("#"+t).modal("show"):alert("Please authorize ChlamBase to edit Wikidata on your behalf!")}}],bindings:{protein:"<"}});angular.module("localizationForm").component("localizationForm",{controller:["$location","$routeParams","pubMedData","sendToView","locusTag2QID","entrez2QID","orthoDataByLocusTag","orthoDataByEntrez","appData","$filter","taxidFilter",function(e,n,t,r,u,c,o,i,a,s,l){"use strict";var d=this;d.currentTaxid=n.taxid,d.currentLocusTag=n.locusTag,d.pageCount=0,l.map().then(function(e){d.tax2Name=e}),d.orthoData={},d.projection={},a.getAppData(function(a){d.appData=a;var e=o;"entrez"==a.primary_identifier&&(e=i),e.getOrthologs(d.currentLocusTag).then(function(e){angular.forEach(e.results.bindings,function(e){var n,t=e.orthoTaxid.value;n="entrez"==a.primary_identifier?e.entrez.value:e.orthoLocusTag.value,d.projection[t]=n==d.currentLocusTag,d.orthoData[t]=n})})}),d.nextClick=function(){d.pageCount+=1},d.backClick=function(){d.pageCount-=1},d.localizationAnnotation={proteinQID:null,pub:null,localizationQID:null,increased:null},d.selectForm=function(){"elementary body AND reticulate body"!=d.localizationAnnotation.localizationQID.name&&(d.localizationAnnotation.increased=null)},d.map=[{name:"elementary body",qid:["Q51955212"]},{name:"reticulate body",qid:["Q51955198"]},{name:"elementary body AND reticulate body",qid:["Q51955212","Q51955198"]}],d.increasedMap=[{name:"elementary body",qid:"Q51955212"},{name:"reticulate body",qid:"Q51955198"},{name:"neither",qid:null}],d.relativeTo={Q51955212:"Q51955198",Q51955198:"Q51955212"},d.getPMID=function(n){return t.getPMID(n).then(function(e){return[e.data.result[n]].map(function(e){return e})})},d.selectPub=function(e,n,t){d.pubValue=e},d.sendData=function(){d.loading=!0;var o=0,i=!0,l=!1,n=!1;if(angular.forEach(d.projection,function(e){1==e&&(n=!0)}),!n)return alert("Please select at least one gene to annotate!"),void(d.loading=!1);angular.forEach(d.projection,function(e,a){if(e){var n=u;"entrez"==d.appData.primary_identifier&&(n=c),n.getQID(d.orthoData[a],a).then(function(e){var n={proteinQID:null,pub:d.pubValue.uid,localizationQID:d.localizationAnnotation.localizationQID.qid,increased:null,relativeTo:null};if(e.data.results.bindings[0].protein&&(n.proteinQID=s("parseQID")(e.data.results.bindings[0].protein.value)),null!=d.localizationAnnotation.increased&&(n.increased=d.localizationAnnotation.increased.qid,n.relativeTo=d.relativeTo[n.increased]),null!=n.proteinQID){var t="/organism/"+a+"/gene/"+d.orthoData[a]+"/wd_localization_edit";console.log(t),r.sendToView(t,n).then(function(e){!1===e.data.authentication?i=!(l=!0):e.data.write_success||(i=!1)}).finally(function(){++o==Object.keys(d.projection).length&&(i?(alert("Successfully Annotated! Well Done! The annotation will appear here in a few minutes."),d.resetForm()):l?(console.log("FAILURE: AUTHENTICATION"),alert("Please authorize ChlamBase to edit Wikidata on your behalf!")):alert("Something went wrong.  Give it another shot!"),d.loading=!1)})}})}else++o==Object.keys(d.projection).length&&(i?(alert("Successfully Annotated! Well Done! The annotation will appear here in a few minutes."),d.resetForm()):l?(console.log("FAILURE: AUTHENTICATION"),alert("Please authorize ChlamBase to edit Wikidata on your behalf!")):alert("Something went wrong.  Give it another shot!"),d.loading=!1)})},d.resetForm=function(){d.pageCount=0,d.pubValue=null,d.localizationAnnotation={proteinQID:null,pub:null,localizationQID:null,increased:null}}}],templateUrl:"/static/build/js/angular_templates/developmental-body-form.min.html"});angular.module("geneNameForm").controller("geneNameCtrl",["$location","sendToView","orthoDataByEntrez","orthoDataByLocusTag","appData","$routeParams","locusTag2QID","entrez2QID","$filter","taxidFilter",function(e,l,a,t,n,o,g,s,u,r){"use strict";var c=this;c.locusTag=o.locusTag,r.map().then(function(e){c.tax2Name=e}),c.orthoData={},c.projection={},n.getAppData(function(n){c.appData=n;var e=t;"entrez"==n.primary_identifier&&(e=a),e.getOrthologs(c.locusTag).then(function(e){angular.forEach(e.results.bindings,function(e){var a,t=e.orthoTaxid.value;a="entrez"==n.primary_identifier?e.entrez.value:e.orthoLocusTag.value,c.projection[t]=a==c.locusTag,c.orthoData[t]=a})})}),c.pageCount=0,c.nextClick=function(){c.pageCount+=1},c.backClick=function(){c.pageCount-=1},c.geneNameData={geneQID:null,proteinQID:null,geneName:""},c.resetForm=function(){c.geneNameData.geneName="",c.pageCount=0},c.$onChanges=function(){c.geneNameData.geneQID=c.gene.geneQID,c.geneNameData.proteinQID=c.gene.proteinQID},c.sendData=function(){var o=0,r=!0,i=!1,a=!1;if(angular.forEach(c.projection,function(e){1==e&&(a=!0)}),!a)return alert("Please select at least one gene to annotate!"),void(c.loading=!1);angular.forEach(c.projection,function(e,n){var a=g;"entrez"==c.appData.primary_identifier&&(a=s),e?a.getQID(c.orthoData[n],n).then(function(e){var a={geneQID:u("parseQID")(e.data.results.bindings[0].gene.value),proteinQID:null,geneName:c.geneNameData.geneName};e.data.results.bindings[0].protein&&(a.proteinQID=u("parseQID")(e.data.results.bindings[0].protein.value));var t="/organism/"+n+"/gene/"+c.orthoData[n]+"/wd_gene_name_edit";console.log(t),l.sendToView(t,a).then(function(e){!1===e.data.authentication?r=!(i=!0):e.data.write_success||(r=!1)}).finally(function(){++o==Object.keys(c.projection).length&&(r?(alert("Successfully Annotated! Well Done! The annotation will appear here in a few minutes."),c.resetForm()):i?(console.log("FAILURE: AUTHENTICATION"),alert("Please authorize ChlamBase to edit Wikidata on your behalf!")):alert("Something went wrong.  Give it another shot!"))})}):++o==Object.keys(c.projection).length&&(r?(alert("Successfully Annotated! Well Done! The annotation will appear here in a few minutes."),c.resetForm()):i?(console.log("FAILURE: AUTHENTICATION"),alert("Please authorize ChlamBase to edit Wikidata on your behalf!")):alert("Something went wrong.  Give it another shot!"),c.resetForm())})}}]).component("geneNameForm",{bindings:{gene:"<"},templateUrl:"/static/build/js/angular_templates/gene-name-form.min.html",controller:"geneNameCtrl"});angular.module("geneSymbolForm").controller("symbolFormCtrl",["$location","sendToView","orthoDataByEntrez","orthoDataByLocusTag","appData","$routeParams","locusTag2QID","entrez2QID","$filter","pubMedData","taxidFilter",function(e,l,t,n,a,o,u,s,g,r,i){"use strict";var c=this;i.map().then(function(e){c.tax2Name=e}),c.orthoData={},c.projection={},a.getAppData(function(a){c.appData=a;var e=n;"entrez"==a.primary_identifier&&(e=t),e.getOrthologs(o.locusTag).then(function(e){angular.forEach(e.results.bindings,function(e){var t,n=e.orthoTaxid.value;t="entrez"==a.primary_identifier?e.entrez.value:e.orthoLocusTag.value,c.projection[n]=t==o.locusTag,c.orthoData[n]=t})})}),c.pageCount=0,c.nextClick=function(){c.pageCount+=1},c.backClick=function(){c.pageCount-=1},c.geneSymbolData={geneQID:null,proteinQID:null,geneSymbol:"",pmid:null},c.resetForm=function(){c.geneSymbolData.geneSymbol="",c.geneSymbolData.pmid=null,c.pageCount=0},c.$onChanges=function(){c.geneSymbolData.geneQID=c.gene.geneQID,c.geneSymbolData.proteinQID=c.gene.proteinQID},c.getPMID=function(t){return r.getPMID(t).then(function(e){return[e.data.result[t]].map(function(e){return e})})},c.selectPub=function(e){c.geneSymbolData.pmid=e.uid},c.sendData=function(){var o=0,r=!0,i=!1,t=!1;if(angular.forEach(c.projection,function(e){1==e&&(t=!0)}),!t)return alert("Please select at least one gene to annotate!"),void(c.loading=!1);angular.forEach(c.projection,function(e,a){var t=u;"entrez"==c.appData.primary_identifier&&(t=s),e?t.getQID(c.orthoData[a],a).then(function(e){var t={geneQID:g("parseQID")(e.data.results.bindings[0].gene.value),proteinQID:null,geneSymbol:c.geneSymbolData.geneSymbol,pmid:c.geneSymbolData.pmid};e.data.results.bindings[0].protein&&(t.proteinQID=g("parseQID")(e.data.results.bindings[0].protein.value));var n="/organism/"+a+"/gene/"+c.orthoData[a]+"/wd_gene_symbol_edit";console.log(n),l.sendToView(n,t).then(function(e){!1===e.data.authentication?r=!(i=!0):e.data.write_success||(r=!1)}).finally(function(){++o==Object.keys(c.projection).length&&(r?(alert("Successfully Annotated! Well Done! The annotation will appear here in a few minutes."),c.resetForm()):i?(console.log("FAILURE: AUTHENTICATION"),alert("Please authorize ChlamBase to edit Wikidata on your behalf!")):alert("Something went wrong.  Give it another shot!"))})}):++o==Object.keys(c.projection).length&&(r?(alert("Successfully Annotated! Well Done! The annotation will appear here in a few minutes."),c.resetForm()):i?(console.log("FAILURE: AUTHENTICATION"),alert("Please authorize ChlamBase to edit Wikidata on your behalf!")):alert("Something went wrong.  Give it another shot!"),c.resetForm())})}}]).component("geneSymbolForm",{controller:"symbolFormCtrl",templateUrl:"/static/build/js/angular_templates/gene-symbol-form.min.html",bindings:{gene:"<"}});angular.module("goForm").component("goForm",{controller:["$routeParams","$filter","$location","evidenceCodes","sendToView","pubMedData","allGoTerms","locusTag2QID","entrez2QID","orthoDataByLocusTag","orthoDataByEntrez","appData","taxidFilter",function(e,i,o,n,u,t,a,g,s,r,l,c,d){var m=this;m.currentTaxid=e.taxid,m.currentLocusTag=e.locusTag,m.pageCount=0,d.map().then(function(e){m.tax2Name=e});var p={mf_button:{name:"Molecular Function",QID:"Q14860489"},cc_button:{name:"Cellular Component",QID:"Q5058355"},bp_button:{name:"Biological Process",QID:"Q2996394"}};m.goFormModel={evi:null,pub:null,go:null,proteinQID:null,goClass:p[m.goclass].QID},n.getevidenceCodes(function(e){m.evidence=e}),m.data={},m.projection={},c.getAppData(function(t){m.appData=t;var e=r;"entrez"==t.primary_identifier&&(e=l),e.getOrthologs(m.currentLocusTag).then(function(e){angular.forEach(e.results.bindings,function(e){var o,n=e.orthoTaxid.value;o="entrez"==t.primary_identifier?e.entrez.value:e.orthoLocusTag.value,m.projection[n]=o==m.currentLocusTag,m.data[n]=o})})}),m.nextClick=function(){m.pageCount+=1},m.backClick=function(){m.pageCount-=1},m.selectGoTerm=function(e,o,n){m.goFormModel.go=e,m.goValue=""},m.selectPub=function(e,o,n){m.goFormModel.pub=e,m.pubValue=""},m.getGoTermsAll=function(e){return m.goTermLoading=!0,a.getGoTermsAll(e,p[m.goclass].QID).then(function(e){return e.data.results.bindings.map(function(e){return e})}).finally(function(){m.goTermLoading=!1})},m.getPMID=function(o){return t.getPMID(o).then(function(e){return[e.data.result[o]].map(function(e){return e})})},m.resetForm=function(){m.pageCount=0,m.goFormModel.evi=null,m.goFormModel.pub=null,m.goFormModel.go=null},m.validateFields=function(){if(m.goFormModel.evi&&m.goFormModel.pub&&m.goFormModel.go)return!0},m.sendData=function(){m.loading=!0;var a=0,r=!0,l=!1,o=!1;if(angular.forEach(m.projection,function(e){1==e&&(o=!0)}),!o)return alert("Please select at least one gene to annotate!"),void(m.loading=!1);angular.forEach(m.projection,function(e,t){var o=g;"entrez"==data.primary_identifier&&(o=s),e?o.getQID(m.data[t],t).then(function(e){var o={evi:m.goFormModel.evi,pub:m.goFormModel.pub,go:m.goFormModel.go,proteinQID:null,goClass:m.goFormModel.goClass};e.data.results.bindings[0].protein&&(o.proteinQID=i("parseQID")(e.data.results.bindings[0].protein.value));var n="/organism/"+t+"/gene/"+m.data[t]+"/wd_go_edit";console.log(n),u.sendToView(n,o).then(function(e){!1===e.data.authentication?r=!(l=!0):e.data.write_success||(r=!1)}).finally(function(){++a==Object.keys(m.projection).length&&(r?(alert("Successfully Annotated! Well Done! The annotation will appear here in a few minutes."),m.resetForm()):l?(console.log("FAILURE: AUTHENTICATION"),alert("Please authorize ChlamBase to edit Wikidata on your behalf!")):alert("Something went wrong.  Give it another shot!"),m.loading=!1)})}):++a==Object.keys(m.projection).length&&(r?(alert("Successfully Annotated! Well Done! The annotation will appear here in a few minutes."),m.resetForm()):l?(console.log("FAILURE: AUTHENTICATION"),alert("Please authorize ChlamBase to edit Wikidata on your behalf!")):alert("Something went wrong.  Give it another shot!"),m.loading=!1)})}}],templateUrl:"/static/build/js/angular_templates/guided-go-form.min.html",bindings:{goclass:"<",gene:"<"}});angular.module("helpForm").controller("helpFormCtrl",["$http",function(n){"use strict";this.name="",this.email="",this.description="",this.submit=function(){this.submitted=!0,null==this.subject&&(this.subject="Chlambase Help");var t="Name: "+this.name+"\nSender: "+this.email+"\nUrl: "+window.location.href+"\nDescription: "+this.description,e="email?subject="+encodeURIComponent(this.subject)+"&body="+encodeURIComponent(t);n.get(e).then(function(t){console.log("Submitted request!")},function(t){console.log("Error submitting request")})}}]).component("helpForm",{templateUrl:"/static/build/js/angular_templates/help-form.min.html",controller:"helpFormCtrl"});angular.module("mutantBatch").component("mutantBatch",{bindings:{data:"<"},controller:["$timeout","uploadFile","Upload",function(l,o,n){"use strict";var u=this;u.uploadFiles=function(a,t){u.f=a,u.errFile=t&&t[0],a&&(o.uploadFile("/wd_upload",a).then(function(t){console.log(t)}),a.upload=n.upload({url:"https://angular-file-upload-cors-srv.appspot.com/upload",data:{file:a}}),a.upload.then(function(t){l(function(){a.result=t.data})},function(t){0<t.status&&(u.errorMsg=t.status+": "+t.data)},function(t){a.progress=Math.min(100,parseInt(100*t.loaded/t.total))}))},u.metaModel={}}],templateUrl:"/static/build/js/angular_templates/mutant-batch.min.html"});angular.module("mutantForm").component("mutantForm",{bindings:{data:"<"},controller:["pubMedData","$filter","$location","$routeParams","locusTag2QID","entrez2QID","wdGetEntities","sendToView","RefSeqChrom","appData",function(n,o,a,e,i,u,m,r,s,t){var l=this;t.getAppData(function(n){var t=i;"entrez"==n.primary_identifier&&(t=u),t.getQID(e.locusTag,e.taxid).then(function(n){var t=n.data.results.bindings;0<t.length&&(l.geneQID=o("parseQID")(t[0].gene.value))}).finally(function(){m.wdGetEntities(l.geneQID).then(function(n){var t=n.entities[l.geneQID];l.genStart=t.claims.P644[0].mainsnak.datavalue.value,l.genEnd=t.claims.P645[0].mainsnak.datavalue.value})}),"locus_tag"==n.primary_identifier?s.getRefSeqChromByLocusTag(e.locusTag).then(function(n){n[0]&&(l.chromosome=n[0].refSeqChromosome.value,l.mutantAnnotation&&(l.mutantAnnotation.chromosome=l.chromosome))}):s.getRefSeqChromByEntrez(e.locusTag).then(function(n){n[0]&&(l.chromosome=n[0].refSeqChromosome.value,l.mutantAnnotation&&(l.mutantAnnotation.chromosome=l.chromosome))})}),l.seq_ontology_map={synonymous:"SO:0001815","non-synonymous":"SO:0001816",non_transcribed_region:"SO:0000183",silent_mutation:"SO:0001017",stop_gained:"SO:0001587"},l.seq_ontology_list=["synonymous","non-synonymous","non_transcribed_region","silent_mutation","stop_gained"],l.mutant_type_map={"chemically induced mutation":"EFO_0000370",transposition:"EFO_0004021",recombination:"EFO_0004293",insertion:"EFO_0004016"},l.mutant_type_list=["chemically induced mutation","transposition","recombination","insertion"],l.getPMID=function(t){return n.getPMID(t).then(function(n){return[n.data.result[t]].map(function(n){return n})})},l.selectPub=function(n,t,o){l.mutantAnnotation.pub=n.uid,l.pubtitle=n.title,l.pubauthor=n.authors[0].name,l.pubdate=n.pubdate},l.$onInit=function(){l.reftype="PMID",l.pubtitle="",l.pubauthor="",l.pubdate="",l.pageCount=0;var n=null;l.mutantAnnotation&&l.mutantAnnotation.name&&(n=l.mutantAnnotation.name),l.mutantAnnotation={taxid:e.taxid,locusTag:e.locusTag,coordinate:{},chromosome:l.chromosome,name:n}},l.resetForm=function(){l.mutantAnnotation.name=null,l.$onInit()},l.sendData=function(n){l.loading=!0,n.action="annotate";var t=a.path().replace("/authorized/","")+"/wd_mutant_edit";console.log(t),r.sendToView(t,n).then(function(n){!0===n.data.write_success?(console.log("SUCCESS"),console.log(n),alert("Successfully Annotated! Well Done! The annotation will appear here soon."),l.resetForm()):!1===n.data.authentication?(console.log("FAILURE: AUTHENTICATION"),alert("Please authorize ChlamBase to edit Wikidata on your behalf!")):(console.log("FAILURE: UNKNOWN"),console.log(n),alert("Something went wrong.  Give it another shot!"))}).finally(function(){l.loading=!1})},l.nextClick=function(){l.pageCount+=1},l.backClick=function(){l.pageCount-=1},l.changeType=function(){var n=l.mutantAnnotation.mutation_name;l.$onInit(),l.mutantAnnotation.mutation_name=n,l.mutantAnnotation.mutation_id=l.mutant_type_map[n]},l.validatePosition=function(){return l.mutantAnnotation.coordinate.start>=l.genStart&&l.mutantAnnotation.coordinate.start<=l.genEnd},l.validateEndPosition=function(){return l.validatePosition()&&l.mutantAnnotation.coordinate.end>=l.mutantAnnotation.coordinate.start&&l.mutantAnnotation.coordinate.end<=l.genEnd},l.validateBase=function(){return l.mutantAnnotation.ref_base&&l.mutantAnnotation.variant_base&&l.mutantAnnotation.ref_base!=l.mutantAnnotation.variant_base},l.validateFields=function(){return!(!l.mutantAnnotation.name||!l.mutantAnnotation.mutation_name||"DOI"==l.reftype&&!l.mutantAnnotation.doi||"PMID"==l.reftype&&!l.mutantAnnotation.pub||!l.validatePosition())&&("chemically induced mutation"==l.mutantAnnotation.mutation_name?l.validateBase()&&l.mutantAnnotation.snv_name&&l.mutantAnnotation.aa_effect:"transposition"==l.mutantAnnotation.mutation_name||"insertion"==l.mutantAnnotation.mutation_name?l.mutantAnnotation.percent_gene_intact&&l.mutantAnnotation.insert_direction:l.validateEndPosition()&&l.mutantAnnotation.genes_inserted&&l.mutantAnnotation.insert_direction)}}],templateUrl:"/static/build/js/angular_templates/mutant-form.min.html"});angular.module("operonForm").component("operonForm",{controller:["$routeParams","$location","$filter","pubMedData","locusTag2QID","allOrgOperons","sendToView","tax2QID","taxidFilter",function(e,n,o,t,a,r,l,u,i){"use strict";var s=this;s.currentTaxid=e.taxid,s.currentLocusTag=e.locusTag,s.opFormModel={name:null,pub:[],genes:[],geneQID:s.gene.geneQID,taxid:s.currentTaxid,taxQID:null,strand:null},i.name(s.currentTaxid).then(function(e){s.opFormModel.taxLabel=e}),s.$onChanges=function(){s.strand&&(s.opFormModel.strand=s.strand)},s.$onInit=function(){s.alerts={success:!1,error:!1},u.getQID(s.currentTaxid).then(function(e){s.opFormModel.taxQID=o("parseQID")(e[0].taxon.value)}),s.pageCount=0,s.nextClick=function(){s.pageCount+=1},s.backClick=function(){s.pageCount-=1},s.getPMID=function(o){return t.getPMID(o).then(function(e){return[e.data.result[o]].map(function(e){return e})})},s.selectPub=function(e,o,n){s.opFormModel.pub.push(e),s.pubValue=""},s.removePub=function(e){console.log(e);var n,t,o,a;s.opFormModel.pub=(n="uid",t=e.uid,o=s.opFormModel.pub,a=[],angular.forEach(o,function(e,o){e[n]!=t&&a.push(e)}),a)},s.selectGene=function(e,o,n){s.opFormModel.genes.push({gene:e.gene.value,locusTag:e.locusTag.value}),s.geneValue=""},s.removeGene=function(e){var n,t,o,a;s.opFormModel.genes=(n="locusTag",t=e.locusTag,o=s.opFormModel.genes,a=[],angular.forEach(o,function(e,o){e[n]!=t&&a.push(e)}),a)},s.validateFields=function(){if(s.opFormModel.name&&s.opFormModel.pub&&0<s.opFormModel.genes.length)return!0},s.sendData=function(e){s.loading=!0;var o=n.path().replace("/authorized/","")+"/wd_operon_edit";l.sendToView(o,e).then(function(e){!0===e.data.operonWrite_success?(alert("Successfully Annotated! Well Done! The annotation will appear here in a few minutes."),s.resetForm()):!1===e.data.authentication?(console.log("FAILURE: AUTHENTICATION"),console.log(e),alert("Please authorize ChlamBase to edit Wikidata on your behalf!")):alert("Something went wrong.  Give it another shot!")}).finally(function(){s.loading=!1})},s.resetForm=function(){s.pageCount=0,s.opFormModel.name=null,s.opFormModel.pub=null,s.opFormModel.genes=[],s.geneValue="",s.pubValue=""}}}],templateUrl:"/static/build/js/angular_templates/operon-form.min.html",bindings:{allorggenes:"<",gene:"<",strand:"<"}});angular.module("pdbForm").component("pdbForm",{controller:["pubMedData","$location","orthoDataByEntrez","orthoDataByLocusTag","appData","locusTag2QID","entrez2QID","$filter","sendToView","taxidFilter","$routeParams",function(t,n,e,o,a,l,u,d,p,i,r){"use strict";var c=this;i.map().then(function(t){c.tax2Name=t}),c.$onInit=function(){c.pdbAnnotation={id:null,pub:null,qid:c.gene.proteinQID,image:null},c.pageCount=0,c.nextClick=function(){c.pageCount+=1},c.backClick=function(){c.pageCount-=1},c.orthoData={},c.projection={},a.getAppData(function(a){c.appData=a;var t=o;"entrez"==a.primary_identifier&&(t=e),t.getOrthologs(r.locusTag).then(function(t){angular.forEach(t.results.bindings,function(t){var n,e=t.orthoTaxid.value;n="entrez"==a.primary_identifier?t.entrez.value:t.orthoLocusTag.value,c.projection[e]=n==r.locusTag,c.orthoData[e]=n})})}),c.getPMID=function(n){return t.getPMID(n).then(function(t){return[t.data.result[n]].map(function(t){return t})})},c.selectPub=function(t,n,e){c.pdbAnnotation.pub=t},c.validateId=function(){return c.pdbAnnotation.id&&4==c.pdbAnnotation.id.length&&1==c.pdbAnnotation.id.match(/[0-9][0-9A-Za-z]{3}/).length},c.sendData=function(){c.loading=!0;var o=0,i=!0,r=!1,n=!1;if(angular.forEach(c.projection,function(t){1==t&&(n=!0)}),!n)return alert("Please select at least one gene to annotate!"),void(c.loading=!1);angular.forEach(c.projection,function(t,a){var n=l;"entrez"==c.appData.primary_identifier&&(n=u),t?n.getQID(c.orthoData[a],a).then(function(t){var n={id:c.pdbAnnotation.id.toUpperCase(),pub:c.pdbAnnotation.pub.uid,qid:null,image:{front:"https://www.ebi.ac.uk/pdbe/static/entry/{}_deposited_chain_front_image-800x800.png".replace("{}",c.pdbAnnotation.id),side:"https://www.ebi.ac.uk/pdbe/static/entry/{}_deposited_chain_side_image-800x800.png".replace("{}",c.pdbAnnotation.id),top:"https://www.ebi.ac.uk/pdbe/static/entry/{}_deposited_chain_top_image-800x800.png".replace("{}",c.pdbAnnotation.id)}};if(t.data.results.bindings[0].protein&&(n.qid=d("parseQID")(t.data.results.bindings[0].protein.value)),null!=n.qid){var e="/organism/"+a+"/gene/"+c.orthoData[a]+"/wd_pdb_edit";console.log(e),p.sendToView(e,n).then(function(t){!1===t.data.authentication?i=!(r=!0):t.data.write_success||(i=!1)}).finally(function(){++o==Object.keys(c.projection).length&&(i?(alert("Successfully Annotated! Well Done! The annotation will appear here in a few minutes."),c.resetForm()):r?(console.log("FAILURE: AUTHENTICATION"),alert("Please authorize ChlamBase to edit Wikidata on your behalf!")):alert("Something went wrong.  Give it another shot!"),c.loading=!1)})}}):++o==Object.keys(c.projection).length&&(i?(alert("Successfully Annotated! Well Done! The annotation will appear here in a few minutes."),c.resetForm()):r?(console.log("FAILURE: AUTHENTICATION"),alert("Please authorize ChlamBase to edit Wikidata on your behalf!")):alert("Something went wrong.  Give it another shot!"),c.loading=!1)})},c.resetForm=function(){c.pageCount=0,c.pdbAnnotation.id=null,c.pubValue="",c.pdbAnnotation.pub=null,c.image=null}}}],templateUrl:"/static/build/js/angular_templates/pdb-form.min.html",bindings:{gene:"<"}});angular.module("hostpathForm").component("hostpathForm",{bindings:{data:"<"},controller:["$location","$routeParams","speciesGenes","pubMedData","sendToView","locusTag2QID","entrez2QID","$filter","orthoDataByEntrez","orthoDataByLocusTag","appData","taxidFilter",function(t,e,n,a,r,l,u,h,o,i,s,p){"use strict";var c=this;p.map().then(function(t){c.tax2Name=t}),c.currentTaxid=e.taxid,c.currentLocusTag=e.locusTag,c.pageCount=0,c.orthoData={},c.projection={},s.getAppData(function(a){c.appData=a;var t=i;"entrez"==a.primary_identifier&&(t=o),t.getOrthologs(c.currentLocusTag).then(function(t){angular.forEach(t.results.bindings,function(t){var e,n=t.orthoTaxid.value;e="entrez"==a.primary_identifier?t.entrez.value:t.orthoLocusTag.value,c.projection[n]=e==c.currentLocusTag,c.orthoData[n]=e})})}),c.nextClick=function(){c.pageCount+=1},c.backClick=function(){c.pageCount-=1},c.hostpathAnnotation={proteinQID:null,host_species:null,pub:null,host_protein:null,determination:null},c.species=[{name:"Homo sapiens",qid:"Q15978631",taxid:"9606"},{name:"Mus musculus",qid:"Q83310",taxid:"10090"},{name:"Chlamydia trachomatis D/UW-3/CX",qid:"Q20800373",taxid:"272561"},{name:"Chlamydia trachomatis 434/BU",qid:"Q20800254",taxid:"471472"},{name:"Chlamydia muridarum Nigg",qid:"Q21398805",taxid:"243161"},{name:"Chlamydophila pneumoniae CWL029",qid:"Q21397863",taxid:"115713"}],c.isChlamydia=function(){return null!=c.hostpathAnnotation.host_species&&"Homo sapiens"!=c.hostpathAnnotation.host_species.name&&"Mus musculus"!=c.hostpathAnnotation.host_species.name},c.determination_methods=[{item:"https://www.wikidata.org/entity/Q32860428",itemLabel:"immunoprecipitation evidence",eco:"ECO:0000085"},{item:"https://www.wikidata.org/entity/Q32860432",itemLabel:"co-localization evidence",eco:"ECO:0001026"}],c.getSpeciesGenes=function(){c.proteinValue="",c.pubValue=null,c.hostpathAnnotation={proteinQID:null,host_species:c.hostpathAnnotation.host_species,pub:null,host_protein:null,determination:null};var t=c.hostpathAnnotation.host_species.taxid;n.getSpeciesGenes(t).then(function(t){c.speciesGenes=t.data.results.bindings})},c.selectProtein=function(t,e,n){c.hostpathAnnotation.host_protein=t},c.getPMID=function(e){return a.getPMID(e).then(function(t){return[t.data.result[e]].map(function(t){return t})})},c.selectPub=function(t,e,n){c.pubValue=t},c.sendData=function(){c.loading=!0;var o=0,i=!0,s=!1,e=!1;if(angular.forEach(c.projection,function(t){1==t&&(e=!0)}),!e)return alert("Please select at least one gene to annotate!"),void(c.loading=!1);angular.forEach(c.projection,function(t,a){var e=l;"entrez"==c.appData.primary_identifier&&(e=u),t?e.getQID(c.orthoData[a],a).then(function(t){var e={proteinQID:null,host_species:c.hostpathAnnotation.host_species,pub:c.hostpathAnnotation.pub,host_protein:c.hostpathAnnotation.host_protein,determination:c.hostpathAnnotation.determination};if(t.data.results.bindings[0].protein&&(e.proteinQID=h("parseQID")(t.data.results.bindings[0].protein.value)),null!=e.proteinQID){var n="/organism/"+a+"/gene/"+c.orthoData[a]+"/wd_hostpath_edit";console.log(n),r.sendToView(n,e).then(function(t){!1===t.data.authentication?i=!(s=!0):t.data.write_success||(i=!1)}).finally(function(){++o==Object.keys(c.projection).length&&(i?(alert("Successfully Annotated! Well Done! The annotation will appear here in a few minutes."),c.resetForm()):s?(console.log("FAILURE: AUTHENTICATION"),alert("Please authorize ChlamBase to edit Wikidata on your behalf!")):alert("Something went wrong.  Give it another shot!"),c.loading=!1)})}}):++o==Object.keys(c.projection).length&&(i?(alert("Successfully Annotated! Well Done! The annotation will appear here in a few minutes."),c.resetForm()):s?(console.log("FAILURE: AUTHENTICATION"),alert("Please authorize ChlamBase to edit Wikidata on your behalf!")):alert("Something went wrong.  Give it another shot!"),c.loading=!1)})},c.resetForm=function(){c.pageCount=0,c.proteinValue="",c.pubValue=null,c.hostpathAnnotation={proteinQID:null,host_species:null,pub:null,host_protein:null,determination:null}}}],templateUrl:"/static/build/js/angular_templates/protein-interactions-form.min.html"});angular.module("cellVisualizer").controller("cellVisualizerCtrl",["geneOntologyService",function(o){"use strict";var t="#cc0000",i=this;function n(e){var n=[];if(n=o.isInclusion(e)?document.getElementsByClassName("inclusion"):document.getElementsByClassName(o.getClass(e)),i.pending--,o.isPlasmaMembrane(e))n[0].style.fill=t,document.getElementsByClassName("cytoplasm")[0].style.fill!=t&&(document.getElementsByClassName("cytoplasm")[0].style.fill="#FFFFFF");else if(o.isInclusion(e))o.isInclusionMembrane(e)?n[0].style.stroke=t:n[0].style.fill=t;else for(var l=0;l<n.length;l++)n[l].style.fill=t;0==i.pending&&(i.loading=!1)}i.status="Loading Component Viewer...",i.loading=!0,i.$onChanges=function(){i.cellComp?(i.pending=i.cellComp.length,angular.forEach(i.cellComp,function(e){var n=e.goID.value.replace(":","_");i.highlight(n)}),i.development&&("+"==i.development.eb.value&&i.highlight("BTO_0000377"),"+"==i.development.rb.value&&i.highlight("BTO_0001172")),0==i.pending&&(i.loading=!1,i.status="No Components to Show")):i.loading=!1},this.displayCell=!1,this.highlight=function(e){o.isValid(e)?(i.displayCell=!0,n(e)):o.getParent(e).then(function(e){i.displayCell=!0,n(e)},function(e){i.pending--,0==i.pending&&(i.loading=!1,i.status="No Components to Show")})}}]).service("geneOntologyService",["$http","$q",function(n,l){var o={GO_0044177:"golgi",GO_0044174:"endosome",GO_0120149:"peroxisome",GO_0042025:"nucleus",GO_0033650:"mitochondria",GO_0044165:"er",GO_0140221:"inclusion_membrane",GO_0140222:"inclusion_lumen",BTO_0001172:"rb",BTO_0000377:"eb",GO_0044187:"lysosome",GO_0044186:"ld",GO_0120148:"centrosome",GO_0044163:"cytoskeleton",GO_0020002:"plasma_membrane",GO_0030430:"cytoplasm",GO_0044164:"cytoplasm"},i=function(e){return!!o[e]};return{getParent:function(o){var t=l.defer(),e=encodeURIComponent(encodeURIComponent("https://purl.obolibrary.org/obo/"+o));return n.get("https://www.ebi.ac.uk/ols/api/ontologies/go/terms/"+e+"/hierarchicalAncestors").success(function(e){if(e._embedded)for(var n=0;n<e._embedded.terms.length;n++){var l=e._embedded.terms[n];if(i(l.short_form))return console.log("Go term "+o+" has parent "+l.label),void t.resolve(l.short_form)}t.reject(e)}).error(function(e){t.reject(e)}),t.promise},isValid:i,getClass:function(e){return o[e]},isPlasmaMembrane:function(e){return"plasma_membrane"==o[e]},isInclusion:function(e){return"inclusion_membrane"==o[e]||"inclusion_lumen"==o[e]},isInclusionMembrane:function(e){return"inclusion_membrane"==o[e]}}}]).component("cellVisualizer",{controller:"cellVisualizerCtrl",templateUrl:"/static/build/js/angular_templates/cell-visualizer-view.min.html",bindings:{cellComp:"<",development:"<"}});angular.module("geneOverview").component("geneOverview",{templateUrl:"/static/build/js/angular_templates/gene-overview.min.html",bindings:{data:"<",annotations:"<"},controller:["$routeParams","sendToView","$location","taxidFilter",function(a,i,n,e){"use strict";var o=this;o.$onInit=function(){o.taxid=a.taxid,o.locusTag=a.locusTag,o.cm=o.tm=o.rm=o.im=0,e.species(o.taxid).then(function(t){o.species=t}),e.strain(o.taxid).then(function(t){o.strain=t});var t=n.path()+"/mg_mutant_view";i.sendToView(t,{locusTag:o.locusTag,taxid:o.taxid}).then(function(t){angular.forEach(t.data.mutants,function(t){"EFO_0000370"==t.mutation_id?o.cm++:"EFO_0004021"==t.mutation_id?o.tm++:"EFO_0004016"==t.mutation_id?o.im++:"EFO_0004293"==t.mutation_id&&o.rm++})})},o.checkAuthorization=function(t){n.path().includes("authorized")?$("#"+t).modal("show"):alert("Please authorize ChlamBase to edit Wikidata on your behalf!")}}]});angular.module("mainPage").component("mainPage",{controller:["$filter","$routeParams","$location","allOrgs","wdGetEntities","entrez2QID","GOTerms","InterPro","OperonData","expasyData","mutantData","locusTag2Pub","locusTag2QID","sendToView","expressionTimingData","hostPathogen","RefSeqChrom","allOrgGenes","$http","ECNumbers","pdbData","proteinSequenceData","proteinMass","developmentalForm","appData",function(t,e,a,n,r,o,u,i,s,c,l,g,p,m,d,h,v,f,G,b,D,T,P,x,y){var w=this;a.path().includes("authorized")&&(console.log("Is authorized"),G.get("validateSession").then(function(e){if(console.log("Login: "+e.data.login),!e.data.login)return alert("Your session has expired!"),void a.path(a.path().replace("authorized/",""))})),y.getAppData(function(e){w.appData=e;var n=p;"entrez"==w.appData.primary_identifier&&(n=o),n.getQID(w.currentLocusTag,w.currentTaxid).then(function(e){var n=e.data.results.bindings;0<n.length?(w.currentGene.geneQID=t("parseQID")(n[0].gene.value),n[0].protein?w.currentGene.proteinQID=t("parseQID")(n[0].protein.value):(w.hasprotein=!1,w.currentGene.productType={id:"Q7187"})):(alert(w.currentLocusTag+" doesn't seem to be a gene in this genome."),a.path("/organism/"+w.currentTaxid))}).finally(function(){r.wdGetEntities(w.currentGene.geneQID).then(function(e){var n=e.entities[w.currentGene.geneQID];w.currentGene.geneLabel=n.labels.en.value,w.currentGene.locusTag=n.claims.P2393[0].mainsnak.datavalue.value,w.currentGene.geneDescription=n.descriptions.en.value,w.currentGene.genStart=n.claims.P644[0].mainsnak.datavalue.value,w.currentGene.genEnd=n.claims.P645[0].mainsnak.datavalue.value,w.currentGene.strand=n.claims.P2548[0].mainsnak.datavalue.value,n.claims.P279&&(w.currentGene.geneType=n.claims.P279[0].mainsnak.datavalue.value),w.currentGene.geneAliases=[],angular.forEach(n.aliases.en,function(e){e.value!=w.currentGene.locusTag&&w.currentGene.geneAliases.push(e.value)}),n.claims.P2561&&(w.currentGene.geneSymbol=n.claims.P2561[0].mainsnak.datavalue.value.text),n.claims.P351&&(w.currentGene.entrez=n.claims.P351[0].mainsnak.datavalue.value),"locus_tag"==w.appData.primary_identifier?s.getOperonDataByLocusTag(w.currentGene.locusTag).then(function(e){var n=e.data.results.bindings;0<n.length?w.annotations.operon=n:w.annotations.operon=[]}):s.getOperonDataByEntrez(w.currentGene.entrez).then(function(e){var n=e.data.results.bindings;0<n.length?w.annotations.operon=n:w.annotations.operon=[]})}),w.currentGene.proteinQID&&r.wdGetEntities(w.currentGene.proteinQID).then(function(e){var n=e.entities[w.currentGene.proteinQID];w.currentGene.proteinLabel=n.labels.en.value,w.currentGene.description=n.descriptions.en.value,w.currentGene.refseqProt=n.claims.P637[0].mainsnak.datavalue.value,n.claims.P279&&(w.currentGene.productType=n.claims.P279[0].mainsnak.datavalue.value),w.currentGene.proteinAliases=[],angular.forEach(n.aliases.en,function(e){w.currentGene.proteinAliases.push(e.value)}),T.getSequence(w.currentGene.refseqProt).then(function(e){w.currentGene.sequenceProt=encodeURIComponent(e)}),n.claims.P352&&(w.currentGene.uniprot=n.claims.P352[0].mainsnak.datavalue.value,x.getDevelopmentalForms(w.currentGene.uniprot).then(function(e){if(w.currentGene.developmentalForm=e.data.results.bindings[0],w.currentGene.developmentalForm){var n=-1!=w.currentGene.developmentalForm.eb.value.indexOf("+")?"+":"",t=-1!=w.currentGene.developmentalForm.rb.value.indexOf("+")?"+":"";w.currentGene.developmentalForm.eb.value=n,w.currentGene.developmentalForm.rb.value=t}}),P.getMass(w.currentGene.uniprot).then(function(e){w.currentGene.mass=e}),D.getPdbData(w.currentGene.uniprot).then(function(e){0<e.data.results.bindings.length&&(w.currentGene.pdbIds=e.data.results.bindings)}),i.getInterPro(w.currentGene.uniprot).then(function(e){w.ipData=e,w.annotations.interpro=e}),h.getHostPathogen(w.currentGene.uniprot).then(function(e){w.hostpathData=e,w.annotations.hostpath=e}),u.getGoTerms(w.currentGene.uniprot).then(function(e){w.annotations.go={cellcomp:[],bioproc:[],molfunc:[]},w.annotations.reaction={},w.mf="mf_button",w.bp="bp_button",w.cc="cc_button";var n=e.data.results.bindings;angular.forEach(n,function(e,n){"http://www.wikidata.org/entity/Q5058355"===e.goclass.value&&w.annotations.go.cellcomp.push(e),"http://www.wikidata.org/entity/Q14860489"===e.goclass.value&&w.annotations.go.molfunc.push(e),"http://www.wikidata.org/entity/Q2996394"===e.goclass.value&&w.annotations.go.bioproc.push(e)})}),b.getECNumbers(w.currentGene.uniprot).then(function(e){var n=e.data.results.bindings;angular.forEach(n,function(e){e.hasOwnProperty("ecnumber")&&-1==w.annotations.ecnumber.indexOf(e.ecnumber.value)&&-1==e.ecnumber.value.indexOf("-")&&w.annotations.ecnumber.push(e.ecnumber.value)})}).finally(function(){angular.forEach(w.annotations.ecnumber,function(e){c.getReactionData(e).then(function(e){console.log(e),w.annotations.reaction[e.ecnumber]=e.reaction})});var e={locusTag:w.currentGene.locusTag,taxid:w.currentGene.taxid,ec_number:w.annotations.ecnumber};getServerAnnotationData(e)}))}),"locus_tag"==w.appData.primary_identifier?v.getRefSeqChromByLocusTag(w.currentLocusTag).then(function(e){e[0]&&(w.currentGene.refseqGenome=e[0].refSeqChromosome.value)}):v.getRefSeqChromByEntrez(w.currentGene.entrez).then(function(e){e[0]&&(w.currentGene.refseqGenome=e[0].refSeqChromosome.value)}),d.getExpression(function(e){w.expression=e;var n=t("keywordFilter")(e,w.currentLocusTag);w.currentExpression={},angular.forEach(n[0],function(e,n){"_id"!=n&&"$oid"!=n&&"timestamp"!=n&&(w.currentExpression[n]=e)}),w.annotations.expression=w.currentExpression});var e=w.currentGene.locusTag.replace("_","");g.getlocusTag2Pub(e).then(function(e){w.annotations.pubList=e.data.resultList.result})})}),w.$onInit=function(){"use strict";w.currentTaxid=e.taxid,w.currentLocusTag=e.locusTag,w.currentGene={locusTag:w.currentLocusTag,taxid:w.currentTaxid},w.annotations={ecnumber:[]},f.getAllOrgGenes(w.currentTaxid).then(function(e){w.currentAllGenes=e.data.results.bindings}),n.getAllOrgs(function(e){w.orgList=e,w.currentOrg=t("getJsonItemOrg")("taxid",w.currentTaxid,w.orgList),null==w.currentOrg&&(alert("not a valid taxonomy id"),a.path("/"))}),w.hasprotein=!0}}],templateUrl:"/static/build/js/angular_templates/main-page_new.min.html"});angular.module("organismView").component("organismView",{templateUrl:"/static/build/js/angular_templates/organism-view.min.html",controller:["$routeParams","taxidFilter",function(t,a){"use strict";var e=this;e.currentTaxid=t.taxid,a.name(e.currentTaxid).then(function(t){e.name=t})}]});