angular.module("hostpathForm").component("hostpathForm",{bindings:{data:"<"},controller:["$location","$routeParams","speciesGenes","pubMedData","sendToView","locusTag2QID","$filter","orthoData",function(t,e,n,o,r,l,u,a){"use strict";var c=this;c.currentTaxid=e.taxid,c.currentLocusTag=e.locusTag,c.pageCount=0,c.orthoData={},c.projection={},a.getOrthologs(c.currentLocusTag).then(function(t){angular.forEach(t.results.bindings,function(t){var e=t.orthoTaxid.value,n=t.orthoLocusTag.value;c.projection[e]=n==c.currentLocusTag,c.orthoData[e]=n})}),c.nextClick=function(){c.pageCount+=1},c.backClick=function(){c.pageCount-=1},c.hostpathAnnotation={proteinQID:null,host_species:null,pub:null,host_protein:null,determination:null},c.species=[{name:"Homo sapiens",qid:"Q15978631",taxid:"9606"},{name:"Mus musculus",qid:"Q83310",taxid:"10090"}],c.determination_methods=[{item:"https://www.wikidata.org/entity/Q32860428",itemLabel:"immunoprecipitation evidence",eco:"ECO:0000085"},{item:"https://www.wikidata.org/entity/Q32860432",itemLabel:"co-localization evidence",eco:"ECO:0001026"}],c.getSpeciesGenes=function(){var t=c.hostpathAnnotation.host_species.taxid;n.getSpeciesGenes(t).then(function(t){c.speciesGenes=t.data.results.bindings})},c.selectProtein=function(t,e,n){c.hostpathAnnotation.host_protein=t},c.getPMID=function(e){return o.getPMID(e).then(function(t){return[t.data.result[e]].map(function(t){return t})})},c.selectPub=function(t,e,n){c.pubValue=t},c.sendData=function(){c.loading=!0;var a=0,i=!0,s=!1,e=!1;return angular.forEach(c.projection,function(t){1==t&&(e=!0)}),e?t.path().includes("authorized")?void angular.forEach(c.projection,function(t,o){t?l.getLocusTag2QID(c.orthoData[o],o).then(function(t){var e={proteinQID:null,host_species:c.hostpathAnnotation.host_species,pub:c.hostpathAnnotation.pub,host_protein:c.hostpathAnnotation.host_protein,determination:c.hostpathAnnotation.determination};if(t.data.results.bindings[0].protein&&(e.proteinQID=u("parseQID")(t.data.results.bindings[0].protein.value)),null!=e.proteinQID){var n="/organism/"+o+"/gene/"+c.orthoData[o]+"/wd_hostpath_edit";console.log(n),r.sendToView(n,e).then(function(t){!1===t.data.authentication?i=!(s=!0):t.data.write_success||(i=!1)}).finally(function(){++a==Object.keys(c.projection).length&&(i?(alert("Successfully Annotated! Well Done! The annotation will appear here in a few minutes."),c.resetForm()):s?(console.log("FAILURE: AUTHENTICATION"),alert("Please authorize ChlamBase to edit Wikidata on your behalf!")):alert("Something went wrong.  Give it another shot!"),c.loading=!1)})}}):++a==Object.keys(c.projection).length&&(i?(alert("Successfully Annotated! Well Done! The annotation will appear here in a few minutes."),c.resetForm()):s?(console.log("FAILURE: AUTHENTICATION"),alert("Please authorize ChlamBase to edit Wikidata on your behalf!")):alert("Something went wrong.  Give it another shot!"),c.loading=!1)}):(alert("Please authorize ChlamBase to edit Wikidata on your behalf!"),void(c.loading=!1)):(alert("Please select at least one gene to annotate!"),void(c.loading=!1))},c.resetForm=function(){c.pageCount=0,c.proteinValue="",c.pubValue=null,c.hostpathAnnotation={proteinQID:null,host_species:null,pub:null,host_protein:null,determination:null}}}],templateUrl:"/static/wiki/js/angular_templates/hostpath-form.html"});