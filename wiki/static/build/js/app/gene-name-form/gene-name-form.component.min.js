angular.module("geneNameForm").controller("geneNameCtrl",["$location","sendToView","orthoData","$routeParams","locusTag2QID","$filter",function(e,l,a,t,s,g){"use strict";var u=this;u.locusTag=t.locusTag,u.orthoData={},u.projection={},a.getOrthologs(u.locusTag).then(function(e){angular.forEach(e.results.bindings,function(e){var a=e.orthoTaxid.value,t=e.orthoLocusTag.value;u.projection[a]=t==u.locusTag,u.orthoData[a]=t})}),u.pageCount=0,u.nextClick=function(){u.pageCount+=1},u.backClick=function(){u.pageCount-=1},u.geneNameData={geneQID:null,proteinQID:null,geneName:""},u.resetForm=function(){u.geneNameData.geneName="",u.pageCount=0},u.$onChanges=function(){u.geneNameData.geneQID=u.gene.geneQID,u.geneNameData.proteinQID=u.gene.proteinQID},u.sendData=function(){var o=0,r=!0,i=!1,a=!1;if(angular.forEach(u.projection,function(e){1==e&&(a=!0)}),!a)return alert("Please select at least one gene to annotate!"),void(u.loading=!1);e.path().includes("authorized")?angular.forEach(u.projection,function(e,n){e?s.getLocusTag2QID(u.orthoData[n],n).then(function(e){var a={geneQID:g("parseQID")(e.data.results.bindings[0].gene.value),proteinQID:null,geneName:u.geneNameData.geneName+" "+u.orthoData[n]};e.data.results.bindings[0].protein&&(a.proteinQID=g("parseQID")(e.data.results.bindings[0].protein.value));var t="/organism/"+n+"/gene/"+u.orthoData[n]+"/wd_gene_name_edit";console.log(t),l.sendToView(t,a).then(function(e){!1===e.data.authentication?r=!(i=!0):e.data.write_success||(r=!1)}).finally(function(){++o==Object.keys(u.projection).length&&(r?(alert("Successfully Annotated! Well Done! The annotation will appear here in a few minutes."),u.resetForm()):i?(console.log("FAILURE: AUTHENTICATION"),alert("Please authorize ChlamBase to edit Wikidata on your behalf!")):alert("Something went wrong.  Give it another shot!"))})}):++o==Object.keys(u.projection).length&&(r?(alert("Successfully Annotated! Well Done! The annotation will appear here in a few minutes."),u.resetForm()):i?(console.log("FAILURE: AUTHENTICATION"),alert("Please authorize ChlamBase to edit Wikidata on your behalf!")):alert("Something went wrong.  Give it another shot!"),u.resetForm())}):alert("Please authorize ChlamBase to edit Wikidata on your behalf!")}}]).component("geneNameForm",{bindings:{gene:"<"},templateUrl:"/static/wiki/js/angular_templates/gene-name-form.html",controller:"geneNameCtrl"});