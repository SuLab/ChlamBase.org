angular.module("operonForm").component("operonForm",{controller:["$routeParams","$location","$filter","pubMedData","locusTag2QID","allOrgOperons","allChlamOrgs","sendToView",function(e,n,o,a,t,r,l,u){"use strict";var i=this;i.$onInit=function(){i.currentTaxid=e.taxid,i.currentLocusTag=e.locusTag,i.alerts={success:!1,error:!1},t.getLocusTag2QID(i.currentLocusTag,i.currentTaxid).then(function(e){i.geneQID=o("parseQID")(e.data.results.bindings[0].gene.value),i.opFormModel={operon:null,pub:[],genes:[],geneQID:i.geneQID,organism:null},i.pageCount=0,i.nextClick=function(){i.pageCount+=1,console.log(i.data)},i.backClick=function(){i.pageCount-=1},l.getAllOrgs(function(e){i.orgList=e,i.opFormModel.organism=o("getJsonItemOrg")("taxid",i.currentTaxid,i.orgList)}),i.getPMID=function(o){return a.getPMID(o).then(function(e){return[e.data.result[o]].map(function(e){return e})})},i.selectPub=function(e,o,n){i.opFormModel.pub.push(e),i.pubValue=""},i.removePub=function(e){console.log(e);var n,a,o,t;i.opFormModel.pub=(n="uid",a=e.uid,o=i.opFormModel.pub,t=[],angular.forEach(o,function(e,o){e[n]!=a&&t.push(e)}),t)},i.nameOperon=function(e){e&&(i.opFormModel.operon={operon:{value:"None"},operonLabel:{value:e}})},i.selectGene=function(e,o,n){i.opFormModel.genes.push({gene:e.gene.value,locusTag:e.locusTag.value}),i.geneValue=""},i.removeGene=function(e){var n,a,o,t;i.opFormModel.genes=(n="locusTag",a=e.locusTag,o=i.opFormModel.genes,t=[],angular.forEach(o,function(e,o){e[n]!=a&&t.push(e)}),t)},i.validateFields=function(){if(i.opFormModel.operon&&i.opFormModel.pub&&0<i.opFormModel.genes.length)return!0},i.sendData=function(e){i.loading=!0;var o=n.path().replace("/authorized/","")+"/wd_operon_edit";if(!n.path().includes("authorized"))return alert("Please authorize ChlamBase to edit Wikidata on your behalf!"),void(i.loading=!1);u.sendToView(o,e).then(function(e){!0===e.data.operonWrite_success?(alert("Successfully Annotated! Well Done! The annotation will appear here in a few minutes."),i.resetForm()):!1===e.data.authentication?(console.log("FAILURE: AUTHENTICATION"),console.log(e),alert("Please authorize ChlamBase to edit Wikidata on your behalf!")):alert("Something went wrong.  Give it another shot!")}).finally(function(){i.loading=!1})},i.resetForm=function(){i.pageCount=0,i.opFormModel.operon=null,i.opFormModel.pub=null,i.opFormModel.genes=[],i.operonValue="",i.geneValue="",i.pubValue=""}})}}],templateUrl:"/static/wiki/js/angular_templates/operon-form.html",bindings:{data:"<",operon:"<",allorggenes:"<"}});