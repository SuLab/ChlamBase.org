angular.module("mutantForm").component("mutantForm",{bindings:{data:"<"},controller:["pubMedData","$filter","$location","$routeParams","locusTag2QID","wdGetEntities","sendToView",function(t,a,e,n,o,i,l){var u=this;u.$onInit=function(){u.reftype="PMID",u.pubtitle="",u.pubauthor="",u.pubdate="",u.mutantAnnotation={taxid:n.taxid,locusTag:n.locusTag,chromosome:null,name:null,mutant_type:{alias:null,name:null,id:null,key:null},coordinate:{start:null},percent_gene_intact:null,insert_direction:null,pub:null,doi:null,ref_base:null,variant_base:null,variant_type:{alias:null,name:null,id:null},aa_effect:null},u.pageCount=0,o.getLocusTag2QID(u.mutantAnnotation.locusTag,u.mutantAnnotation.taxid).then(function(t){var n=t.data.results.bindings;0<n.length&&(u.geneQID=a("parseQID")(n[0].gene.value))}).finally(function(){i.wdGetEntities(u.geneQID).then(function(t){var n=t.entities[u.geneQID];u.genStart=n.claims.P644[0].mainsnak.datavalue.value,u.genEnd=n.claims.P645[0].mainsnak.datavalue.value,n.claims.P644[0].qualifiers.P1057?u.mutantAnnotation.chromosome=n.claims.P644[0].qualifiers.P1057[0].datavalue.value:n.claims.P644[0].qualifiers.P2249&&(u.mutantAnnotation.chromosome=n.claims.P644[0].qualifiers.P2249[0].datavalue.value)})}),u.nextClick=function(){u.pageCount+=1},u.backClick=function(){u.pageCount-=1},u.seq_ontology_map=[{alias:"SYNONYMOUS",name:"synonymous",id:"SO:0001814"},{alias:"Non-neutral",name:"non-synonymous",id:"SO:0001816"},{alias:"NON-CODING",name:"non_transcribed_region",id:"SO:0000183"},{alias:"Neutral",name:"silent_mutation",id:"SO:0001017"},{alias:"NONSENSE",name:"stop_gained",id:"SO:0001017"}],u.mutant_type_map=[{alias:"chemical mutagenesis",name:"chemically induced mutation",id:"EFO_0000370",key:1},{alias:"transposon mutagenesis",name:"tbd",id:"tbd",key:2}],u.getPMID=function(n){return t.getPMID(n).then(function(t){return[t.data.result[n]].map(function(t){return t})})},u.selectPub=function(t,n,a){u.mutantAnnotation.pub=t.uid,u.pubtitle=t.title,u.pubauthor=t.authors[0].name,u.pubdate=t.pubdate},u.resetForm=function(){u.$onInit()},u.sendData=function(t){if(u.loading=!0,t.action="annotate",e.path().includes("authorized")){var n=e.path().replace("/authorized/","")+"/wd_mutant_edit";console.log(n),l.sendToView(n,t).then(function(t){!0===t.data.write_success?(console.log("SUCCESS"),console.log(t),alert("Successfully Annotated! Well Done! The annotation will appear here soon."),u.resetForm()):!1===t.data.authentication?(console.log("FAILURE: AUTHENTICATION"),alert("Please authorize ChlamBase to edit Wikidata on your behalf!")):(console.log("FAILURE: UNKNOWN"),console.log(t),alert("Something went wrong.  Give it another shot!"))}).finally(function(){u.loading=!1})}else alert("Please authorize ChlamBase to edit Wikidata on your behalf!")},u.validatePosition=function(){return u.mutantAnnotation.coordinate.start>=u.genStart&&u.mutantAnnotation.coordinate.start<=u.genEnd},u.validateBase=function(){return u.mutantAnnotation.ref_base&&u.mutantAnnotation.variant_base&&u.mutantAnnotation.ref_base!=u.mutantAnnotation.variant_base},u.validateFields=function(){return!(!u.mutantAnnotation.name||!u.mutantAnnotation.mutant_type||"DOI"==u.reftype&&!u.mutantAnnotation.doi||"PMID"==u.reftype&&!u.mutantAnnotation.pub||!u.validatePosition())&&(1==u.mutantAnnotation.mutant_type.key?u.validateBase()&&u.mutantAnnotation.variant_type&&u.mutantAnnotation.aa_effect:u.mutantAnnotation.percent_gene_intact&&u.mutantAnnotation.insert_direction)}}}],templateUrl:"/static/wiki/js/angular_templates/mutant-form.html"});